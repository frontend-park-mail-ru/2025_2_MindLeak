(()=>{"use strict";var e={783:(e,t,s)=>{s.d(t,{DeletePostModal:()=>r});let n=null;class r{constructor(e={}){this.element=null,this.resolvePromise=null,this.handleKeyDown=e=>{"Escape"===e.key&&this.close(!1)},this.props=e,this.promise=new Promise(e=>{this.resolvePromise=e})}async render(){const e=(await async function(){if(n)return n;const e=await fetch("/components/DeletePostModal/DeletePostModal.hbs"),t=await e.text();return n=Handlebars.compile(t),n}())(this.props),t=document.createElement("div");if(t.innerHTML=e.trim(),this.element=t.firstElementChild,!this.element)throw new Error("DeletePostModal element not found");return this.setupEventListeners(),this.element}setupEventListeners(){if(!this.element)return;this.element.addEventListener("click",e=>{e.target===this.element&&this.close(!1)});const e=this.element.querySelector(".delete-post-modal__cancel");e&&e.addEventListener("click",()=>{this.close(!1)});const t=this.element.querySelector(".delete-post-modal__delete");t&&t.addEventListener("click",()=>{this.handleDelete()}),document.addEventListener("keydown",this.handleKeyDown)}close(e){this.resolvePromise&&this.resolvePromise(e),this.destroy()}handleDelete(){const e=this.element?.querySelector(".delete-post-modal__delete");e&&(e.disabled=!0,e.textContent="–£–¥–∞–ª–µ–Ω–∏–µ..."),this.close(!0)}async waitForResult(){return this.promise}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.element&&this.element.parentNode&&this.element.remove()}}}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const n=new class{async request(e,t={}){try{const s=`https://mindleak.ru/api${e}`,n={};t.body instanceof FormData||(n["Content-Type"]="application/json");const r=await fetch(s,{headers:{...n,...t.headers},credentials:"include",...t}),i=r.headers.get("content-type");let o=null;if(i&&i.includes("application/json"))try{o=await r.json()}catch(e){}return{status:r.status,data:o,message:r.statusText}}catch(t){return console.error(`AJAX Network error for ${e}:`,t),{status:0,message:"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º üò≠"}}}async get(e){return this.request(e)}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e,t){return this.request(e,{method:"DELETE",body:t?JSON.stringify(t):void 0})}async getMe(){return this.get("/me")}async login(e){return this.post("/login",e)}async register(e){return this.post("/registration",e)}async logout(){return this.get("/logout")}getFeed(e,t=0){if(e){const s=`/feed/category?topic=${encodeURIComponent(e)}&offset=${t}`;return this.get(s)}{const e=`/feed?offset=${t}`;return this.get(e)}}async createPost(e){return this.post("/posts",e)}async deletePost(e){return this.delete(`/posts/${e}`)}async deleteAccount(){return this.delete("/profile/delete")}async editPost(e,t){return this.put(`/posts/${e}`,t)}async uploadAvatar(e){return this.request("/uploads/avatar",{method:"POST",body:e})}async deleteAvatar(){return this.request("/delete/avatar",{method:"DELETE"})}async uploadCover(e){return this.request("/uploads/cover",{method:"POST",body:e})}async deleteCover(){return this.request("/delete/cover",{method:"DELETE"})}},r=200,i=400,o=401,a=new class{handleAction(e,t){switch(e){case"LOGIN_CHECK_REQUEST":this.checkAuth();break;case"LOGIN_REQUEST":this.login(t.email,t.password);break;case"LOGOUT_REQUEST":this.logout();break;case"SIGNUP_REQUEST":this.signUp(t.name,t.email,t.password);break;case"POSTS_LOAD_REQUEST":this.loadPosts(t?.filter);break;case"POST_LOAD_REQUEST":this.loadPost(t.postId);break;case"PROFILE_LOAD_REQUEST":this.loadProfile(t.userId);break;case"PROFILE_UPDATE_DESCRIPTION_REQUEST":this.updateProfileDescription(t.description);break;case"SETTINGS_ACCOUNT_LOAD_REQUEST":this.loadSettingsAccount();break;case"SETTINGS_ACCOUNT_UPDATE_REQUEST":case"EDIT_PROFILE_UPDATE_REQUEST":this.updateSettingsAccount(t.settings);break;case"ACCOUNT_DELETE_REQUEST":this.deleteAccount();break;case"CREATE_POST_REQUEST":this.createPost(t);break;case"POST_DELETE_REQUEST":this.deletePost(t.postId);break;case"POST_EDIT_REQUEST":this.loadPostForEdit(t.postId);break;case"EDIT_POST_REQUEST":this.editPost(t.postId,t);break;case"AVATAR_UPLOAD_REQUEST":this.uploadAvatar(t.file);break;case"AVATAR_DELETE_REQUEST":this.deleteAvatar();break;case"COVER_UPLOAD_REQUEST":this.uploadCover(t.file);break;case"COVER_DELETE_REQUEST":this.deleteCover()}}sendAction(e,t){c.dispatch(e,t)}normalizePostData(e){return{id:e.id||e.ID||e.postId,authorId:e.author_id||e.AuthorID,authorName:e.author_name||e.AuthorName,authorAvatar:e.author_avatar||e.AuthorAvatar,title:e.title||e.Title,content:e.content||e.Content,image:e.media_url||e.MediaURL||e.image||"",commentsCount:e.comments_count||e.CommentsCount||0,repostsCount:e.reposts_count||e.RepostsCount||0,viewsCount:e.views_count||e.ViewsCount||0,theme:e.Topic?.Title||e.theme||e.Topic?.title||"–ë–µ–∑ —Ç–µ–º—ã",topic_id:e.topic_id||e.Topic?.TopicId||e.Topic?.topic_id||0,tags:[]}}async checkAuth(){const e=await n.getMe();switch(e.status){case r:if(e.data){const t={id:e.data.id,name:e.data.name,avatar:e.data.avatar||"/img/defaultAvatar.jpg",subtitle:e.data.subtitle||"–ë–ª–æ–≥"};this.sendAction("USER_LOGIN_CHECKED",{user:t})}else this.sendAction("USER_LOGIN_FAIL",{error:"No user data"});break;case o:this.sendAction("USER_LOGIN_FAIL",{error:"Not authenticated"});break;default:this.sendAction("USER_LOGIN_FAIL",{error:e.message||"Auth check failed"})}}async login(e,t){const s=await n.login({email:e,password:t});switch(s.status){case r:if(s.data){const e={id:s.data.id,name:s.data.name,avatar:s.data.avatar||"/img/defaultAvatar.jpg",subtitle:s.data.subtitle||"–ë–ª–æ–≥"};this.sendAction("USER_LOGIN_SUCCESS",{user:e})}else this.sendAction("USER_LOGIN_FAIL",{error:"No user data in response"});break;case o:case i:case 404:this.sendAction("USER_LOGIN_FAIL",{error:"Email –∏–ª–∏ –ø–∞—Ä–æ–ª—å —É–∫–∞–∑–∞–Ω—ã –Ω–µ–≤–µ—Ä–Ω–æ"});break;default:this.sendAction("USER_LOGIN_FAIL",{error:s.data?.error||s.message||"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"})}}async logout(){(await n.logout()).status===r?this.sendAction("USER_LOGOUT"):this.sendAction("USER_LOGOUT_FAIL",{error:"Logout failed"})}async editPost(e,t){const s=await n.editPost(e,{title:t.title,content:t.content,topic_id:t.topic_id});200===s.status?(this.sendAction("EDIT_POST_SUCCESS"),this.sendAction("POSTS_RELOAD_AFTER_EDIT")):this.sendAction("EDIT_POST_FAIL",{error:s.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å—Ç"})}async loadPostForEdit(e){const t=await n.get(`/post?id=${e}`);if(200===t.status&&t.data){const e=this.normalizePostData(t.data);this.sendAction("POST_EDIT_LOAD_SUCCESS",{post:e})}else this.sendAction("POST_EDIT_LOAD_FAIL",{error:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å—Ç"})}async signUp(e,t,s){const i=await n.register({name:e,email:t,password:s});switch(i.status){case r:case 201:this.sendAction("USER_SIGNUP_SUCCESS");break;case 409:this.sendAction("USER_SIGNUP_FAIL",{error:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"});break;default:this.sendAction("USER_SIGNUP_FAIL",{error:i.data?.globalError||i.message||"–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"})}}async loadPosts(e,t=0){let s;switch(s=e&&"fresh"!==e?await n.get(`/feed/category?topic=${encodeURIComponent(e)}&offset=${t}`):await n.get(`/feed?offset=${t}`),s.status){case r:if(s.data){const e=(s.data.articles||s.data).map(e=>this.normalizePostData(e));this.sendAction("POSTS_LOAD_SUCCESS",{posts:e})}else this.sendAction("POSTS_LOAD_FAIL",{error:"No posts data"});break;case 204:this.sendAction("POSTS_LOAD_FAIL",{error:"No more content"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("POSTS_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("POSTS_LOAD_FAIL",{error:s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤"})}}async loadPost(e){const t=await n.get(`/posts/${e}`);switch(t.status){case r:t.data?this.sendAction("POST_LOAD_SUCCESS",{post:t.data}):this.sendAction("POST_LOAD_FAIL",{error:"Post data is empty"});break;case 404:this.sendAction("POST_LOAD_FAIL",{error:"–ü–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("POST_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("POST_LOAD_FAIL",{error:t.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞"})}}async loadUserPosts(e){let t=`/posts?author_id=${e}`;const s=await n.get(t);return s.status===r&&s.data?(s.data.articles||s.data||[]).map(e=>this.normalizePostData(e)):[]}async loadProfile(e){let t="/profile";e&&(t=`/profile?id=${e}`);const s=await n.get(t);switch(s.status){case r:if(s.data){const e={id:s.data.id,name:s.data.name,email:s.data.email,avatar_url:s.data.avatar_url,cover_url:s.data.cover_url,description:s.data.description,subscribers:s.data.subscribers||0,subscriptions:s.data.subscriptions||0,postsCount:s.data.posts_count||0,isSubscribed:s.data.is_subscribed||!1},t=await this.loadUserPosts(e.id);this.sendAction("PROFILE_LOAD_SUCCESS",{profile:e,posts:t})}else this.sendAction("PROFILE_LOAD_FAIL",{error:"No profile data"});break;case 404:this.sendAction("PROFILE_LOAD_FAIL",{error:"–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("PROFILE_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("PROFILE_LOAD_FAIL",{error:s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è"})}}async updateProfileDescription(e){const t=await n.get("/profile");if(t.status!==r||!t.data)return void this.sendAction("PROFILE_UPDATE_DESCRIPTION_FAIL",{error:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è"});const s=t.data,i={phone:s.phone||"",country:s.country||"–†–æ—Å—Å–∏—è",language:s.language||"–†—É—Å—Å–∫–∏–π",sex:s.sex||"other",date_of_birth:s.date_of_birth||"",name:s.name||"",email:s.email||"",description:e},a=await n.put("/profile",i);switch(a.status){case r:this.sendAction("PROFILE_UPDATE_DESCRIPTION_SUCCESS",{description:e});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("PROFILE_UPDATE_DESCRIPTION_FAIL",{error:"Not authenticated"});break;default:this.sendAction("PROFILE_UPDATE_DESCRIPTION_FAIL",{error:a.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è"})}}async loadSettingsAccount(){const e=await n.get("/profile");switch(e.status){case r:if(e.data){const t={phone:e.data.phone||"",country:e.data.country||"–†–æ—Å—Å–∏—è",language:e.data.language||"–†—É—Å—Å–∫–∏–π",sex:e.data.sex||"other",date_of_birth:e.data.date_of_birth||"",cover_url:e.data.cover_url,name:e.data.name||"",avatar_url:e.data.avatar_url,email:e.data.email||"",created_at:e.data.created_at||""};this.sendAction("SETTINGS_ACCOUNT_LOAD_SUCCESS",{settings:t})}else this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:"No settings data"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"})}}async updateSettingsAccount(e){const t=await n.put("/profile",e);switch(t.status){case r:t.data?(this.sendAction("SETTINGS_ACCOUNT_UPDATE_SUCCESS"),this.loadSettingsAccount()):this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:"No updated data"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:t.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"})}}async deleteAccount(){const e=await n.deleteAccount();switch(e.status){case r:this.sendAction("ACCOUNT_DELETE_SUCCESS"),this.sendAction("USER_LOGOUT");break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("ACCOUNT_DELETE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("ACCOUNT_DELETE_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞"})}}async createPost(e){const t=await n.createPost(e);switch(t.status){case r:case 201:t.data?(this.sendAction("CREATE_POST_SUCCESS",t.data),this.sendAction("POSTS_RELOAD_AFTER_CREATE")):this.sendAction("CREATE_POST_FAIL",{error:"–ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã"});break;case i:this.sendAction("CREATE_POST_FAIL",{error:t.data?.globalError||t.data?.message||"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞"});break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("CREATE_POST_FAIL",{error:"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤"});break;default:this.sendAction("CREATE_POST_FAIL",{error:t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç"})}}async deletePost(e){200===(await n.deletePost(`/${e}`)).status?(this.sendAction("POST_DELETE_SUCCESS",{postId:e}),this.sendAction("POSTS_RELOAD_AFTER_DELETE")):this.sendAction("POST_DELETE_FAIL",{error:"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç"})}async uploadAvatar(e){const t=new FormData;t.append("file",e);const s=await n.uploadAvatar(t);switch(s.status){case r:this.sendAction("AVATAR_UPLOAD_SUCCESS"),this.loadSettingsAccount();break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("AVATAR_UPLOAD_FAIL",{error:"Not authenticated"});break;case i:this.sendAction("AVATAR_UPLOAD_FAIL",{error:s.data?.error||"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞"});break;default:this.sendAction("AVATAR_UPLOAD_FAIL",{error:s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞"})}}async deleteAvatar(){const e=await n.deleteAvatar();switch(e.status){case r:this.sendAction("AVATAR_DELETE_SUCCESS"),this.loadSettingsAccount();break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("AVATAR_DELETE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("AVATAR_DELETE_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞"})}}async uploadCover(e){const t=new FormData;t.append("file",e);const s=await n.uploadCover(t);switch(s.status){case r:this.sendAction("COVER_UPLOAD_SUCCESS"),this.loadSettingsAccount();break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("COVER_UPLOAD_FAIL",{error:"Not authenticated"});break;case i:this.sendAction("COVER_UPLOAD_FAIL",{error:s.data?.error||"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞"});break;default:this.sendAction("COVER_UPLOAD_FAIL",{error:s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–ª–æ–∂–∫–∏"})}}async deleteCover(){const e=await n.deleteCover();switch(e.status){case r:this.sendAction("COVER_DELETE_SUCCESS"),this.loadSettingsAccount();break;case o:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("COVER_DELETE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("COVER_DELETE_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±–ª–æ–∂–∫–∏"})}}},c=new class{constructor(){this.callbacks={}}register(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}dispatch(e,t){a.handleAction(e,t),(this.callbacks[e]||[]).forEach(s=>{try{s(t)}catch(t){console.error(`Error in callback for ${e}:`,t)}})}unregister(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter(e=>e!==t))}};class d{constructor(e){this.listeners=[],this.state=e,this.registerActions()}getState(){return{...this.state}}setState(e){this.state={...this.state,...e},this.emitChange()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)}emitChange(){this.listeners.forEach(e=>e())}registerAction(e,t){c.register(e,t)}}const l=new class extends d{constructor(){super({user:null,isLoggedIn:!1,isLoading:!1,error:null}),this.restoreAuthState()}registerActions(){this.registerAction("USER_LOGIN_CHECKED",e=>{const t={user:e.user,isLoggedIn:!0,isLoading:!1,error:null};this.setState(t),this.saveAuthState(t)}),this.registerAction("USER_LOGIN_SUCCESS",e=>{const t={user:e.user,isLoggedIn:!0,isLoading:!1,error:null};this.setState(t),this.saveAuthState(t)}),this.registerAction("USER_LOGIN_FAIL",e=>{const t={user:null,isLoggedIn:!1,isLoading:!1,error:e.error};this.setState(t),this.clearAuthState()}),this.registerAction("USER_LOGOUT",()=>{this.setState({user:null,isLoggedIn:!1,isLoading:!1,error:null}),this.clearAuthState()}),this.registerAction("USER_UNAUTHORIZED",()=>{this.setState({user:null,isLoggedIn:!1,isLoading:!1,error:"–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞"}),this.clearAuthState()})}restoreAuthState(){try{const e=localStorage.getItem("authState");if(e){const t=JSON.parse(e),s=localStorage.getItem("authStateTime");if(s&&Date.now()-parseInt(s)>864e5)return void this.clearAuthState();this.setState({user:t.user,isLoggedIn:t.isLoggedIn})}}catch(e){console.error("Error loading auth state from localStorage:",e)}}saveAuthState(e){try{localStorage.setItem("authState",JSON.stringify({user:e.user,isLoggedIn:e.isLoggedIn})),localStorage.setItem("authStateTime",Date.now().toString())}catch(e){console.error("Error saving auth state to localStorage:",e)}}clearAuthState(){try{localStorage.removeItem("authState"),localStorage.removeItem("authStateTime")}catch(e){console.error("Error clearing auth state from localStorage:",e)}}};let h=null;class u{async render(){const e=(await async function(){if(h)return h;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const s=await fetch("/components/FormButton/FormButton.hbs"),n=await s.text();Handlebars.registerPartial("button",Handlebars.compile(n));const r=await fetch("/components/LoginForm/LoginForm.hbs"),i=await r.text();return h=Handlebars.compile(i),h}())({}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Modal element not found");return s.addEventListener("click",e=>{e.target===s&&s.remove()}),s}getFormElement(e){return e.querySelector(".login-form__body")}getSignUpLink(e){return e.querySelector(".login-form__footer .link")}}let p=null;class m{async render(){const e=(await async function(){if(p)return p;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const s=await fetch("/components/FormButton/FormButton.hbs"),n=await s.text();Handlebars.registerPartial("button",Handlebars.compile(n));const r=await fetch("/components/SignUpForm/SignUpForm.hbs"),i=await r.text();return p=Handlebars.compile(i),p}())({}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Modal element not found");return s.addEventListener("click",e=>{e.target===s&&s.remove()}),s}getFormElement(e){return e.querySelector(".registration-form__body")}getLoginLink(e){return e.querySelector(".registration-form__footer .link")}}const g=new class extends d{constructor(){super({isLoading:!1,error:null,fieldErrors:[],isSuccess:!1})}registerActions(){this.registerAction("SIGNUP_REQUEST",()=>{this.setState({isLoading:!0,error:null,fieldErrors:[],isSuccess:!1})}),this.registerAction("USER_SIGNUP_SUCCESS",()=>{this.setState({isLoading:!1,error:null,fieldErrors:[],isSuccess:!0})}),this.registerAction("USER_SIGNUP_FAIL",e=>{this.setState({isLoading:!1,error:e.error||null,fieldErrors:e.fieldErrors||[],isSuccess:!1})}),this.registerAction("SIGNUP_RESET",()=>{this.setState({isLoading:!1,error:null,fieldErrors:[],isSuccess:!1})})}};class E{constructor(){this.formElement=null,this.signUpForm=new m,this.boundStoreHandler=this.handleStoreChange.bind(this),this.init()}init(){g.addListener(this.boundStoreHandler)}async render(){return this.formElement=await this.signUpForm.render(),this.setupEventHandlers(),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector(".registration-form__body");if(e){const t=e.cloneNode(!0);e.parentNode?.replaceChild(t,e),t.addEventListener("submit",this.handleSubmit.bind(this)),this.setupPasswordToggles(t)}const t=this.formElement.querySelector(".registration-form__footer .link");t&&t.addEventListener("click",this.handleLoginClick.bind(this))}setupPasswordToggles(e){const t=e.querySelectorAll(".password-toggle"),s=e.querySelectorAll('input[type="password"]');t.forEach((e,t)=>{e.addEventListener("click",()=>{const n=s[t];"password"===n.type?(n.type="text",e.textContent="üôà"):(n.type="password",e.textContent="üôâ")})})}async handleSubmit(e){if(e.preventDefault(),!this.formElement)return;const t=this.formElement.querySelector(".registration-form__body"),s=new FormData(t),n=s.get("username"),r=s.get("email")?.trim(),i=s.get("password"),o=s.get("confirmPassword");this.clearErrors(t);const a=[];n?n.length<4?a.push({field:"username",message:"–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤"}):n.length>32&&a.push({field:"username",message:"–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ—Ä–æ—á–µ 33 —Å–∏–º–≤–æ–ª–æ–≤"}):a.push({field:"username",message:"–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"}),r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?r.length>320&&a.push({field:"email",message:"email –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—á–µ 320 —Å–∏–º–≤–æ–ª–æ–≤"}):a.push({field:"email",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"}):a.push({field:"email",message:"Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),i?/\s/.test(i)?a.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):i.length<4?a.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):i.length>64&&a.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—á–µ 65 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):a.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),o?i!==o&&a.push({field:"confirmPassword",message:"–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"}):a.push({field:"confirmPassword",message:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"}),a.length>0?this.showFieldErrors(t,a):c.dispatch("SIGNUP_REQUEST",{name:n,email:r,password:i})}handleStoreChange(){const e=g.getState();if(e.error&&this.formElement){const t=this.formElement.querySelector(".registration-form__body");this.showFieldErrors(t,[{field:"email",message:e.error}])}if(e.fieldErrors&&this.formElement){const t=this.formElement.querySelector(".registration-form__body");this.showFieldErrors(t,e.fieldErrors)}e.isSuccess&&this.formElement&&(this.destroy(),window.location.reload())}showFieldErrors(e,t){t.forEach(({field:t,message:s})=>{const n=e.querySelector(`input[name="${t}"]`);if(!n)return;n.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=s;const i=n.closest(".input-wrapper");i?i.parentNode.insertBefore(r,i.nextSibling):n.parentNode.insertBefore(r,n.nextSibling)})}showGlobalError(e,t){const s=document.createElement("div");s.className="global-error",s.textContent=t,e.appendChild(s)}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}handleLoginClick(e){e.preventDefault(),this.destroy(),(new S).render().then(e=>{document.body.appendChild(e)})}destroy(){g.removeListener(this.boundStoreHandler),this.formElement&&this.formElement.parentNode&&this.formElement.remove()}}class S{constructor(e){this.formElement=null,this.loginForm=new u,this.boundStoreHandler=this.handleStoreChange.bind(this),this.targetUrl=e||null,this.init()}init(){l.addListener(this.boundStoreHandler)}async render(){return this.formElement=await this.loginForm.render(),this.setupEventHandlers(),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector(".login-form__body");if(e){const t=e.cloneNode(!0);e.parentNode?.replaceChild(t,e),t.addEventListener("submit",this.handleSubmit.bind(this)),this.setupPasswordToggle(t)}const t=this.formElement.querySelector(".login-form__footer .link");t&&t.addEventListener("click",this.handleSignUpClick.bind(this))}setupPasswordToggle(e){const t=e.querySelector(".password-toggle"),s=e.querySelector('input[name="password"]');t&&s&&t.addEventListener("click",()=>{"password"===s.type?(s.type="text",t.textContent="üôà"):(s.type="password",t.textContent="üôâ")})}async handleSubmit(e){if(e.preventDefault(),!this.formElement)return;const t=this.formElement.querySelector(".login-form__body"),s=new FormData(t),n=s.get("email")?.trim(),r=s.get("password");this.clearErrors(t);const i=[];n?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||i.push({field:"email",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"}):i.push({field:"email",message:"Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),r?/\s/.test(r)?i.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):r.length<4?i.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):r.length>64&&i.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—á–µ 65 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):i.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),i.length>0?this.showFieldErrors(t,i):c.dispatch("LOGIN_REQUEST",{email:n,password:r})}handleStoreChange(){const e=l.getState();if(e.error&&this.formElement){const t=this.formElement.querySelector(".login-form__body");this.showFieldErrors(t,[{field:"email",message:e.error}])}e.isLoggedIn&&this.formElement&&(this.destroy(),this.targetUrl&&"/"!==this.targetUrl?f.navigate(this.targetUrl):window.location.reload())}showFieldErrors(e,t){t.forEach(({field:t,message:s})=>{const n=e.querySelector(`input[name="${t}"]`);if(!n)return;n.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=s;const i=n.closest(".input-wrapper");i?i.parentNode.insertBefore(r,i.nextSibling):n.parentNode.insertBefore(r,n.nextSibling)})}showGlobalError(e,t){const s=document.createElement("div");s.className="global-error",s.textContent=t,e.appendChild(s)}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}handleSignUpClick(e){e.preventDefault(),this.destroy(),(new E).render().then(e=>{document.body.appendChild(e)})}destroy(){l.removeListener(this.boundStoreHandler),this.formElement&&this.formElement.parentNode&&this.formElement.remove()}}const f=new class{constructor(){this.routes=[],this.currentView=null,this.isInitialized=!1,this.pendingRoute=null,this.isRendering=!1,this.loginModal=null,this.handleRouteChange=this.handleRouteChange.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),this.handleLoginStoreChange=this.handleLoginStoreChange.bind(this)}addRoute(e,t,s,n=!1){this.routes.push({path:e,view:t,title:s,requiresAuth:n})}init(){this.isInitialized||(window.addEventListener("popstate",this.handleRouteChange),document.addEventListener("click",this.handleLinkClick),l.addListener(this.handleLoginStoreChange),this.checkAuthAndRoute(),this.isInitialized=!0)}async checkAuthAndRoute(){if(l.getState().isLoggedIn)return console.log("‚úÖ [ROUTER] User already logged in from store"),void this.handleRouteChange();console.log("‚è≥ [ROUTER] Checking auth status..."),c.dispatch("LOGIN_CHECK_REQUEST"),await new Promise(e=>{const t=()=>{const s=l.getState();s.isLoading||(l.removeListener(t),console.log("‚úÖ [ROUTER] Auth check completed, isLoggedIn:",s.isLoggedIn),e())};l.addListener(t)}),this.handleRouteChange()}closeLoginModal(){this.loginModal&&this.loginModal.parentNode&&(this.loginModal.parentNode.removeChild(this.loginModal),this.loginModal=null,console.log("üö™ [ROUTER] Login modal closed"))}async handleRouteChange(){const e=window.location.pathname+window.location.search;await this.navigate(e,!1)}handleLinkClick(e){const t=e.target.closest("a[href]");if(!t)return;const s=t.getAttribute("href");!s||s.startsWith("http")||s.startsWith("mailto:")||s.startsWith("tel:")||s.startsWith("#")||t.hasAttribute("data-router-ignore")||(e.preventDefault(),this.navigate(s))}async navigate(e,t=!0){const s="/"===e?"/":`/${e.replace(/^\/+/,"")}`;t&&window.history.pushState({},"",s);const n=this.findRoute(s);n?await this.renderView(n,s):await this.show404()}findRoute(e){const t=e.split("?")[0],s="/"===t?"/":`/${t.replace(/^\/+/,"")}`;console.log("üîç [ROUTER] Searching route for path:",s);const n=this.routes.find(e=>e.path===s);if(n)return console.log("[ROUTER] Exact match found:",n.path),n;for(const e of this.routes)if(e.path.includes(":")){const t=this.pathToRegex(e.path);if(s.match(t))return console.log("[ROUTER] Pattern match found:",e.path,"for",s),e}return console.log("[ROUTER] No route found for:",s),null}extractParams(e,t){const s={},n=e.split("/"),r=t.split("?")[0].split("/");for(let e=0;e<n.length;e++)if(n[e].startsWith(":")){const t=n[e].slice(1);s[t]=r[e]||""}try{new URL(t,window.location.origin).searchParams.forEach((e,t)=>{s[t]=e})}catch(e){}return s}pathToRegex(e){const t=e.replace(/:\w+/g,"([^/]+)");return new RegExp(`^${t}$`)}async renderView(e,t){if(this.isRendering)console.log("[ROUTER] Render already in progress, skipping...");else{console.log("[ROUTER] renderView started for route:",e.path,"path:",t),this.isRendering=!0;try{const s=this.isUserAuthenticated();if(console.log("[ROUTER] Auth status:",{isAuthenticated:s,requiresAuth:e.requiresAuth}),e.requiresAuth&&!s){console.log("[ROUTER] Route requires auth, showing login"),this.pendingRoute={route:e,path:t},this.closeLoginModal();const s=new S(t);return this.loginModal=await s.render(),void document.body.appendChild(this.loginModal)}this.loginModal&&(console.log("[ROUTER] Closing login modal - user can access protected route"),this.closeLoginModal()),this.currentView&&"function"==typeof this.currentView.destroy&&(console.log("[ROUTER] Destroying previous view"),this.currentView.destroy()),e.title&&(document.title=e.title);try{const s=e.view;let n={};t&&(n=this.extractParams(e.path,t),console.log("[ROUTER] Extracted params:",n));const r=document.getElementById("root");if(r)if(console.log("[ROUTER] Creating new view instance"),this.currentView=new s(r,n),console.log("[ROUTER] Clearing content and rendering..."),r.innerHTML="","function"==typeof this.currentView.render){console.log("[ROUTER] Calling view.render()...");const e=await this.currentView.render();r.appendChild(e),console.log("[ROUTER] View rendered successfully")}else console.log("[ROUTER] View has no render method");else console.log("[ROUTER] No root element found")}catch(e){console.error("[ROUTER] Error rendering view:",e),await this.show404()}}finally{this.isRendering=!1}}}isUserAuthenticated(){return l.getState().isLoggedIn}handleLoginStoreChange(){const e=l.getState();if(e.isLoggedIn&&this.pendingRoute&&!e.isLoading){console.log("[ROUTER] User logged in with pending route");const{route:e,path:t}=this.pendingRoute;this.pendingRoute=null,this.closeLoginModal(),this.navigate(t||e.path,!1)}!e.isLoggedIn&&this.loginModal&&(console.log("[ROUTER] User logged out, closing modal"),this.closeLoginModal())}async show404(){const e=document.getElementById("root");e&&(e.innerHTML='\n                <div style="text-align: center; padding: 50px;">\n                    <h1>404 - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h1>\n                    <p>–ó–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.</p>\n                    <a href="/" data-router-link>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>\n                </div>\n            ')}destroy(){window.removeEventListener("popstate",this.handleRouteChange),document.removeEventListener("click",this.handleLinkClick),l.removeListener(this.handleLoginStoreChange),this.closeLoginModal(),this.currentView&&"function"==typeof this.currentView.destroy&&this.currentView.destroy(),this.isInitialized=!1,this.isRendering=!1}};let _=null;class A{constructor({user:e,menuItems:t}){this.user=e,this.menuItems=t||[{key:"bookmarks",icon:"/img/icons/note_icon.svg",text:"–ß–µ—Ä–Ω–æ–≤–∏–∫–∏"},{key:"saved",icon:"/img/icons/bookmark.svg",text:"–ó–∞–∫–ª–∞–¥–∫–∏"},{key:"settings",icon:"/img/icons/settings_icon.svg",text:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"subscription",icon:"/img/icons/premium_icon.svg",text:"–ü–æ–¥–ø–∏—Å–∫–∞"},{key:"logout",icon:"/img/icons/exit_icon.svg",text:"–í—ã–π—Ç–∏"}]}async render(){const e=(await async function(){if(_)return _;const e=await fetch("/components/UserMenu/UserMenu.hbs"),t=await e.text();Handlebars.registerPartial("user-menu",Handlebars.compile(t));const s=await fetch("/components/MenuItem/MenuItem.hbs"),n=await s.text();Handlebars.registerPartial("menu-item",Handlebars.compile(n));const r=await fetch("/components/PopUpMenu/PopUpMenu.hbs"),i=await r.text();return _=Handlebars.compile(i),_}())({user:this.user,menuItems:this.menuItems}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Popup menu element not found");const n=s.querySelector(".user-menu");return n&&(n.style.cursor="pointer",n.addEventListener("click",e=>{e.preventDefault(),s.parentNode&&s.remove(),window.history.pushState({},"","/profile"),window.dispatchEvent(new PopStateEvent("popstate"))})),s.querySelectorAll(".menu-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.key;switch(s.parentNode&&s.remove(),n){case"logout":!async function(){try{c.dispatch("LOGOUT_REQUEST")}catch(e){}}();break;case"settings":window.history.pushState({},"","/settings"),window.dispatchEvent(new PopStateEvent("popstate"));break;case"profile":window.history.pushState({},"","/profile"),window.dispatchEvent(new PopStateEvent("popstate"))}})}),s.addEventListener("click",e=>{e.stopPropagation()}),s}}const w=new class extends d{constructor(){super({draftTitle:"",draftContent:"",currentTheme:"–ë–µ–∑ —Ç–µ–º—ã",currentThemeId:0,isCreating:!1,success:!1,error:null,isEditing:!1,editingPostId:null})}registerActions(){this.registerAction("CREATE_POST_FORM_INIT",()=>{this.setState({draftTitle:"",draftContent:"",currentTheme:"–ë–µ–∑ —Ç–µ–º—ã",currentThemeId:0,isCreating:!1,success:!1,error:null,isEditing:!1,editingPostId:null})}),this.registerAction("POST_TITLE_CHANGED",e=>{this.setState({draftTitle:e.title})}),this.registerAction("POST_CONTENT_CHANGED",e=>{this.setState({draftContent:e.content})}),this.registerAction("THEME_SELECTED",e=>{this.setState({currentTheme:e.themeName,currentThemeId:e.topic_id})}),this.registerAction("POST_EDIT_LOAD_SUCCESS",e=>{this.setState({draftTitle:e.post.title||"",draftContent:e.post.content||"",currentTheme:e.post.theme||"–ë–µ–∑ —Ç–µ–º—ã",currentThemeId:e.post.topic_id||0,isEditing:!0,editingPostId:e.post.id,success:!1,error:null})}),this.registerAction("CREATE_POST_REQUEST",()=>{this.setState({isCreating:!0,error:null})}),this.registerAction("CREATE_POST_SUCCESS",()=>{this.setState({isCreating:!1,success:!0,error:null})}),this.registerAction("CREATE_POST_FAIL",e=>{this.setState({isCreating:!1,success:!1,error:e.error})}),this.registerAction("EDIT_POST_REQUEST",()=>{this.setState({isCreating:!0,error:null})}),this.registerAction("POST_EDIT_REQUEST",e=>{this.setState({isEditing:!0,editingPostId:e.postId,success:!1,error:null,isCreating:!1}),c.dispatch("POST_EDIT_LOAD_REQUEST",{postId:e.postId})}),this.registerAction("EDIT_POST_SUCCESS",()=>{this.setState({isCreating:!1,success:!0,error:null,isEditing:!1,editingPostId:null})}),this.registerAction("CREATE_POST_FORM_CLOSE",()=>{this.setState({isEditing:!1,editingPostId:null,success:!1,error:null})}),this.registerAction("POST_EDIT_LOAD_SUCCESS",e=>{this.setState({draftTitle:e.post.title||"",draftContent:e.post.content||"",currentTheme:e.post.theme||"–ë–µ–∑ —Ç–µ–º—ã",currentThemeId:e.post.topic_id||0,isEditing:!0,editingPostId:e.post.id,success:!1,error:null})}),this.registerAction("POST_EDIT_LOAD_FAIL",e=>{this.setState({isEditing:!1,editingPostId:null,error:e.error})}),this.registerAction("EDIT_POST_FAIL",e=>{this.setState({isCreating:!1,error:e.error})})}};let C=null;const y=[{topic_id:11,key:"fresh",icon:"/img/icons/Fresh_icon.svg",text:"–°–≤–µ–∂–µ–µ"},{topic_id:12,key:"—Ç—Ä–µ–Ω–¥—ã",icon:"/img/icons/trends_icon.svg",text:"–¢—Ä–µ–Ω–¥—ã"},{topic_id:13,key:"–õ–µ–Ω—Ç–∞",icon:"/img/icons/feed_icon.svg",text:"–õ–µ–Ω—Ç–∞"},{topic_id:14,key:"–°–æ–æ–±—â–µ–Ω–∏—è",icon:"/img/icons/chat_icon.svg",text:"–°–æ–æ–±—â–µ–Ω–∏—è"}],L=[{topic_id:1,key:"–°–µ—Ä–≤–∏—Å—ã",icon:"/img/icons/services_icon.svg",text:"–°–µ—Ä–≤–∏—Å—ã"},{topic_id:2,key:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",icon:"/img/icons/marketing_icon.svg",text:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},{topic_id:3,key:"–î–µ–Ω—å–≥–∏",icon:"/img/icons/money_icon.svg",text:"–î–µ–Ω—å–≥–∏"},{topic_id:4,key:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è",icon:"/img/icons/travel_icon.svg",text:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"},{topic_id:5,key:"AI",icon:"/img/icons/AI_icon.svg",text:"AI"},{topic_id:6,key:"–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç",icon:"/img/icons/person-exp_icon.svg",text:"–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç"},{topic_id:7,key:"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",icon:"/img/icons/invest_icon.svg",text:"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"},{topic_id:8,key:"–ö–∞—Ä—å–µ—Ä–∞",icon:"/img/icons/career_icon.svg",text:"–ö–∞—Ä—å–µ—Ä–∞"},{topic_id:9,key:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",icon:"/img/icons/edu_icon.svg",text:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"}];class T{constructor(e,t="fresh",s=()=>{}){this.menuItems=e,this.currentActiveKey=t,this.onSelect=s}async render(){const e=(await async function(){if(C)return C;const e=await fetch("/components/MenuItem/MenuItem.hbs"),t=await e.text();Handlebars.registerPartial("menu-item",Handlebars.compile(t));const s=await fetch("/components/SidebarMenu/SidebarMenu.hbs"),n=await s.text();return C=Handlebars.compile(n),C}())({menuItems:this.menuItems}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Sidebar element not found");const n=e=>{this.currentActiveKey=e,s.querySelectorAll(".menu-item").forEach(t=>{t.classList.toggle("menu-item--active",t.dataset.key===e)})};return n(this.currentActiveKey),s.querySelectorAll(".menu-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const s=e.dataset.key;s&&(n(s),this.onSelect(s))})}),s}}let v=null;class I{constructor(e){this.onSelect=e,this.popupElement=null}async render(){const e=document.createElement("div");e.className="theme-selector-popup";const t=new T(L,"",e=>{const t=L.find(t=>t.key===e);t&&this.onSelect(t.topic_id||0,t.text),this.close()}),s=await t.render();return s.classList.add("theme-selector-popup__menu"),e.appendChild(s),setTimeout(()=>{const t=s=>{e.contains(s.target)||(this.close(),document.removeEventListener("click",t))};document.addEventListener("click",t)},0),document.body.appendChild(e),this.popupElement=e,e}close(){this.popupElement?.parentNode&&this.popupElement.remove(),this.popupElement=null}}class b{constructor(){this.formElement=null,this.maxChars=5e3,this.isAutoOpened=!1,this.boundStoreHandler=this.handleStoreChange.bind(this),w.addListener(this.boundStoreHandler)}handleStoreChange(){const e=w.getState();if(e.isEditing&&e.editingPostId&&!this.formElement&&!this.isAutoOpened)return this.isAutoOpened=!0,void this.openForm();if(e.success&&this.formElement){this.destroy(),this.triggerPostsReload();const t=e.isEditing?"–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω!":"–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!";return void c.dispatch("SHOW_NOTIFICATION",{type:"success",message:t})}e.error&&this.showError(e.error),this.updateUIFromState(e)}triggerPostsReload(){c.dispatch("POSTS_RELOAD_AFTER_CREATE"),c.dispatch("POSTS_RELOAD_AFTER_CREATE")}async openForEdit(){this.formElement||(this.isAutoOpened=!0,await this.openForm())}async openForm(){const e=await this.render();document.body.appendChild(e)}updateUIFromState(e){if(!this.formElement)return;const t=this.formElement.querySelector('[data-key="submit-post"]');t&&(t.disabled=e.isCreating,e.isEditing?t.textContent=e.isCreating?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è":t.textContent=e.isCreating?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å");const s=this.formElement.querySelector(".user-menu__subtitle");s&&(s.textContent=e.currentTheme);const n=this.formElement.querySelector('[data-key="select-theme"]');if(n){const t=0!==e.currentThemeId;n.textContent=t?"–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É":"–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É",n.classList.toggle("theme-button--selected",t)}const r=this.formElement.querySelector('[data-key="post-content"]'),i=this.formElement.querySelector('[data-key="post-title"]');r&&r.value!==e.draftContent&&(r.value=e.draftContent),i&&i.value!==e.draftTitle&&(i.value=e.draftTitle);const o=this.formElement.querySelector(".char-counter__number");o&&(o.textContent=(this.maxChars-e.draftContent.length).toString())}showError(e){if(!this.formElement)return;const t=this.formElement.querySelector(".create-post-form__error");t&&t.remove();const s=document.createElement("div");s.className="create-post-form__error",s.textContent=e;const n=this.formElement.querySelector('[data-key="create-post-form"]');n?.parentNode&&n.parentNode.insertBefore(s,n)}async render(){const e=await async function(){if(v)return v;await Promise.all([{name:"input",path:"/components/Input/Input.hbs"},{name:"form-button",path:"/components/FormButton/FormButton.hbs"},{name:"icon",path:"/components/Icon/Icon.hbs"},{name:"user-menu",path:"/components/UserMenu/UserMenu.hbs"},{name:"menu-item",path:"/components/MenuItem/MenuItem.hbs"}].map(async e=>{if(!Handlebars.partials[e.name]){const t=await fetch(e.path),s=await t.text();Handlebars.registerPartial(e.name,Handlebars.compile(s))}}));const e=await fetch("/components/CreatePostForm/CreatePostForm.hbs"),t=await e.text();return v=Handlebars.compile(t),v}(),t=l.getState(),s=w.getState(),n=e({name:t.user?.name||"–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",subtitle:s.currentTheme,avatar:t.user?.avatar||"/img/defaultAvatar.jpg",isEditing:s.isEditing}),r=document.createElement("div");return r.innerHTML=n.trim(),this.formElement=r.firstElementChild,this.formElement.classList.add("create-post-form--modal"),this.setupEventHandlers(),this.updateUIFromState(s),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector('[data-key="overlay"]');e?.addEventListener("click",e=>{e.target===e.currentTarget&&this.destroy()});const t=this.formElement.querySelector('[data-key="create-post-form"]');t?.addEventListener("submit",async e=>{e.preventDefault();const s=new FormData(t);let n=s.get("title"),r=s.get("content");if("string"!=typeof n&&(n=""),"string"!=typeof r&&(r=""),n=n.trim(),0===n.length)return void this.showError("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º");if(n.length>200)return void this.showError("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 200 —Å–∏–º–≤–æ–ª–æ–≤");if(r.length>5e3)return void this.showError("–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5000 —Å–∏–º–≤–æ–ª–æ–≤");const i={title:n,content:r,topic_id:w.getState().currentThemeId},o=w.getState();o.isEditing&&o.editingPostId?((e,t)=>{c.dispatch("EDIT_POST_REQUEST",{postId:e,...t})})(o.editingPostId,i):(e=>{c.dispatch("CREATE_POST_REQUEST",e)})(i)});const s=this.formElement.querySelector('[data-key="post-content"]');s?.addEventListener("input",e=>{var t;t=e.target.value,c.dispatch("POST_CONTENT_CHANGED",{content:t})});const n=this.formElement.querySelector('[data-key="post-title"]');n?.addEventListener("input",e=>{c.dispatch("POST_TITLE_CHANGED",{title:e.target.value})});const r=this.formElement.querySelector('[data-key="select-theme"]');r?.addEventListener("click",async()=>{const e=new I((e,t)=>{!function(e,t){c.dispatch("THEME_SELECTED",{themeName:e,topic_id:t})}(t,e)});await e.render()});const i=this.formElement.querySelector('[data-key="close-button"]');i?.addEventListener("click",()=>{this.destroy()})}destroy(){w.removeListener(this.boundStoreHandler),this.formElement&&this.formElement.parentNode&&(this.formElement.remove(),this.formElement=null),c.dispatch("CREATE_POST_FORM_INIT"),this.isAutoOpened=!1}}let P=null,R=!1,O=null;class U{constructor(){this.headerElement=null,this.container=null,this.boundStoreHandler=this.handleStoreChange.bind(this),this.init()}init(){l.addListener(this.boundStoreHandler),c.dispatch("LOGIN_CHECK_REQUEST")}async render(e){e&&(this.container=e);const t=await async function(){return P||O||(R=!0,O=(async()=>{try{const[e,t,s,n]=await Promise.all([fetch("/components/Input/Input.hbs"),fetch("/components/FormButton/FormButton.hbs"),fetch("/components/Icon/Icon.hbs"),fetch("/components/Header/Header.hbs")]);if(!Handlebars.partials.input){const t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t))}if(!Handlebars.partials.button){const e=await t.text();Handlebars.registerPartial("button",Handlebars.compile(e))}if(!Handlebars.partials.icon){const e=await s.text();Handlebars.registerPartial("icon",Handlebars.compile(e))}const r=await n.text();return P=Handlebars.compile(r),P}catch(e){throw O=null,R=!1,e}})(),O)}(),s=l.getState(),n=t({isLoggedIn:s.isLoggedIn,user:s.user}),r=document.createElement("div");if(r.innerHTML=n.trim(),this.headerElement&&this.headerElement.parentNode&&this.headerElement.remove(),this.headerElement=r.firstElementChild,!this.headerElement)throw new Error("Header element not found");return this.setupEventHandlers(),this.headerElement}async showLoginForm(e){const t=new S(e),s=await t.render();document.body.appendChild(s)}setupEventHandlers(){if(!this.headerElement)return;const e=l.getState(),t=this.headerElement.querySelector('[data-key="logo"]');t&&t.addEventListener("click",e=>{e.preventDefault(),this.navigateToHome()});const s=this.headerElement.querySelector(".user_info_header");s&&s.addEventListener("click",async t=>{if(t.stopPropagation(),!e.isLoggedIn){const e=window.location.pathname+window.location.search;return void await this.showLoginForm(e)}const n=document.querySelector(".popUp-menu");if(n)return void n.remove();const r=new A({user:e.user,menuItems:[{key:"bookmarks",icon:"/img/icons/note_icon.svg",text:"–ß–µ—Ä–Ω–æ–≤–∏–∫–∏"},{key:"saved",icon:"/img/icons/bookmark.svg",text:"–ó–∞–∫–ª–∞–¥–∫–∏"},{key:"settings",icon:"/img/icons/settings_icon.svg",text:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"subscription",icon:"/img/icons/premium_icon.svg",text:"–ü–æ–¥–ø–∏—Å–∫–∞"},{key:"logout",icon:"/img/icons/exit_icon.svg",text:"–í—ã–π—Ç–∏"}]}),i=await r.render(),o=s.getBoundingClientRect();i.style.position="fixed",i.style.top=`${o.bottom+10}px`,i.style.right=window.innerWidth-o.right+"px",i.style.zIndex="1000",document.body.appendChild(i);const a=e=>{const t=e.target;i.contains(t)||t===s||(i.remove(),document.removeEventListener("click",a))};document.addEventListener("click",a)});const n=this.headerElement.querySelector('button[data-key="createPost"]');n&&(e.isLoggedIn?n.addEventListener("click",async e=>{e.preventDefault();const t=new b,s=await t.render();document.body.appendChild(s)}):n.addEventListener("click",async e=>{e.preventDefault(),await this.showLoginForm()}));const r=this.headerElement.querySelector('button[data-key="login"]');r&&!e.isLoggedIn&&r.addEventListener("click",async e=>{e.preventDefault(),await this.showLoginForm()})}navigateToHome(){f.navigate("/")}async handleStoreChange(){if(this.container&&this.headerElement){const e=await this.render();this.container.appendChild(e)}}destroy(){l.removeListener(this.boundStoreHandler),this.headerElement&&this.headerElement.parentNode&&this.headerElement.remove()}}let D=null;const k=[{name:"–ê–∫–∫–∞—É–Ω—Ç 1",subtitle:"250,4k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 2",subtitle:"245,2k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 3",subtitle:"240,1k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 4",subtitle:"235,7k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 5",subtitle:"230,3k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 6",subtitle:"225,8k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 7",subtitle:"220,5k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"}];class N{constructor({bloggers:e=k}={}){this.bloggers=e}async render(){const e=(await async function(){if(D)return D;const e=await fetch("/components/UserMenu/UserMenu.hbs"),t=await e.text();Handlebars.registerPartial("user-menu",Handlebars.compile(t));const s=await fetch("/components/TopBloggers/TopBloggers.hbs"),n=await s.text();return D=Handlebars.compile(n),D}())({bloggers:this.bloggers.slice(0,7)}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Top bloggers element not found");return s}}var F=s(783);class x{constructor(e,t,s,n){if(this.isOpen=!1,this.isInitialized=!1,this.handleClickOutside=e=>{const t=e.target;this.element.contains(t)||this.menuButton.contains(t)||this.close()},this.handleEscapeKey=e=>{"Escape"===e.key&&this.close()},e.hasAttribute("data-postcard-menu-initialized"))return this.menuButton=e,this.element=t,this.postId=s,this.onMenuItemClick=n,void this.init();this.menuButton=e,this.element=t,this.postId=s,this.onMenuItemClick=n,this.init()}init(){this.isInitialized||(this.menuButton.setAttribute("data-postcard-menu-initialized","true"),this.isInitialized=!0,this.menuButton.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggle()}),this.element.querySelectorAll("[data-key]").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const s=e.getAttribute("data-key");await this.handleMenuItemClick(s),this.close()})}))}async handleMenuItemClick(e){e&&("delete"!==e?("edit"===e&&c.dispatch("CREATE_POST_FORM_INIT"),this.onMenuItemClick?this.onMenuItemClick(e,this.postId):"edit"===e&&this.handleEdit()):await this.handleDelete())}handleEdit(){c.dispatch("POST_EDIT_REQUEST",{postId:this.postId})}async handleDelete(){const e=new F.DeletePostModal,t=await e.render();document.body.appendChild(t),await e.waitForResult()&&(c.dispatch("POST_DELETE_REQUEST",{postId:this.postId}),setTimeout(()=>{c.dispatch("PROFILE_RELOAD_AFTER_DELETE")},1e3))}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(document.querySelectorAll(".post-card-menu").forEach(e=>{e!==this.element&&e.classList.remove("post-card-menu--open")}),this.element.classList.add("post-card-menu--open"),this.isOpen=!0,document.addEventListener("click",this.handleClickOutside),document.addEventListener("keydown",this.handleEscapeKey))}close(){this.isOpen&&(this.element.classList.remove("post-card-menu--open"),this.isOpen=!1,document.removeEventListener("click",this.handleClickOutside),document.removeEventListener("keydown",this.handleEscapeKey))}}let H=null;class M{constructor(e){this.postId=e.postId,this.image=e.image||"";const{user:t={name:"–ê–∫–∫–∞—É–Ω—Ç",subtitle:"—Ç–µ–º–∞",avatar:null,isSubscribed:!1},title:s="–ë–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞",text:n="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –ø–æ–º–µ–Ω—å—à–µ",link:r="",linkText:i="—Å—Å—ã–ª–∫–∞",tags:o=["—Ç–µ–≥1","—Ç–µ–≥2","—Ç–µ–≥3"],commentsCount:a=123,repostsCount:c=42,viewsCount:d=42,isOwnPost:l=!1,canEdit:h=!1}=e;this.user=t,this.title=s,this.text=n,this.link=r,this.linkText=i,this.tags=o,this.commentsCount=a,this.repostsCount=c,this.viewsCount=d,this.menuId=`post-card-menu-${Date.now()}-${Math.floor(1e3*Math.random())}`,this.isOwnPost=l,this.canEdit=h,this.onMenuAction=e.onMenuAction}async render(){const e=this.text.length>200?this.text.substring(0,200):null;let t=[{key:"hide",text:"–°–∫—Ä—ã—Ç—å"},{key:"report",text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è"}];this.isOwnPost&&(t=[{key:"edit",text:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"},{key:"delete",text:"–£–¥–∞–ª–∏—Ç—å"},...t]);const s=(await async function(){if(H)return H;await Promise.all([{name:"user-menu",path:"/components/UserMenu/UserMenu.hbs"},{name:"tag",path:"/components/Tag/Tag.hbs"},{name:"icon",path:"/components/Icon/Icon.hbs"},{name:"menu-item",path:"/components/MenuItem/MenuItem.hbs"},{name:"post-card-menu",path:"/components/PostCardMenu/PostCardMenu.hbs"}].map(async e=>{if(!Handlebars.partials[e.name]){const t=await fetch(e.path),s=await t.text();Handlebars.registerPartial(e.name,Handlebars.compile(s))}}));const e=await fetch("/components/PostCard/PostCard.hbs"),t=await e.text();return H=Handlebars.compile(t),H}())({user:{...this.user,isOwnProfile:this.isOwnPost},title:this.title,text:this.text,textTruncated:e,link:this.link,linkText:this.linkText,image:this.image,tags:this.tags,commentsCount:this.commentsCount,repostsCount:this.repostsCount,viewsCount:this.viewsCount,menuId:this.menuId,menuItems:t,canEdit:this.canEdit}),n=document.createElement("div");n.innerHTML=s.trim();const r=n.firstElementChild;if(!r)throw new Error("Post card element not found");this.setupAuthorClickHandlers(r);const i=r.querySelector('[data-key="toggle-text"]'),o=r.querySelector(".post-card__text-preview"),a=r.querySelector(".post-card__text-full");if(i&&o&&a){let e=!1;i.addEventListener("click",t=>{t.preventDefault(),e=!e,o.hidden=e,a.hidden=!e,i.textContent=e?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é"})}const c=r.querySelector(".post-card__menu-button"),d=r.querySelector(".post-card-menu");return c&&d&&new x(c,d,this.postId,(e,t)=>{this.handleMenuAction(e,t)}),r}handleMenuAction(e,t){"edit"===e?this.handleEditPost():this.onMenuAction?.(e)}async handleEditPost(){c.dispatch("POST_EDIT_REQUEST",{postId:this.postId})}setupAuthorClickHandlers(e){const t=e.querySelector(".user-menu__avatar"),s=e.querySelector(".user-menu__name"),n=e.querySelector(".user-menu__subtitle"),r=e.querySelector(".user-menu__button"),i=e=>{e.preventDefault(),e.stopPropagation();const t=l.getState(),s=this.user.id;if(!s)return;const n=`/profile?id=${s}`;t.isLoggedIn?f.navigate(n):this.showLoginForm(n)};t&&(t.style.cursor="pointer",t.addEventListener("click",i)),s&&(s.style.cursor="pointer",s.addEventListener("click",i)),n&&(n.style.cursor="pointer",n.addEventListener("click",i));const o=e.querySelector(".user-menu");o&&(o.style.cursor="pointer",o.addEventListener("click",e=>{r&&r.contains(e.target)||i(e)})),r&&r.addEventListener("click",e=>{e.stopPropagation()})}async showLoginForm(e){const t=new S(e),s=await t.render();document.body.appendChild(s)}}const q=new class extends d{constructor(){super({posts:[],isLoading:!1,error:null,hasMore:!0,currentFilter:"fresh"})}registerActions(){this.registerAction("POSTS_LOAD_START",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("POSTS_LOAD_SUCCESS",e=>{this.setState({posts:e.posts,isLoading:!1,hasMore:e.posts.length>0})}),this.registerAction("POSTS_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("POSTS_CLEAR",()=>{this.setState({posts:[],error:null})}),this.registerAction("POSTS_SET_FILTER",e=>{this.setState({posts:[],currentFilter:e.filter,hasMore:!0,error:null,isLoading:!1}),c.dispatch("POSTS_LOAD_REQUEST",{filter:e.filter})}),this.registerAction("POSTS_RELOAD_AFTER_CREATE",()=>{this.setState({posts:[],isLoading:!0,error:null}),c.dispatch("POSTS_LOAD_REQUEST",{filter:this.state.currentFilter})}),this.registerAction("POSTS_RELOAD_AFTER_DELETE",()=>{this.setState({posts:[],isLoading:!0,error:null}),c.dispatch("POSTS_LOAD_REQUEST",{filter:this.state.currentFilter})}),this.registerAction("POSTS_FORCE_REFRESH",()=>{this.setState({posts:[],isLoading:!0,error:null}),c.dispatch("POSTS_LOAD_REQUEST",{filter:this.state.currentFilter})})}};class W{constructor(){this.feedWrapper=null,this.sentinel=null,this.observer=null,this.virtualPostIndex=0,this.allPosts=[],this.currentFilter="fresh",this.isInitialized=!1,this.boundStoreHandler=this.handleStoreChange.bind(this),this.handlePostAction=this.handlePostAction.bind(this),this.initStoreListener()}initStoreListener(){q.addListener(this.boundStoreHandler)}async init(e){if(this.feedWrapper=e||document.getElementById("feed-wrapper"),!this.feedWrapper)throw new Error("Feed wrapper not found");this.cleanupScroll();const t=new URL(window.location.href),s=t.pathname,n=t.searchParams.get("topic");"/feed/category"===s&&n?(this.currentFilter=n,c.dispatch("POSTS_LOAD_REQUEST",{filter:n})):(this.currentFilter="fresh",c.dispatch("POSTS_LOAD_REQUEST",{filter:"fresh"})),this.setupInfiniteScroll(),this.isInitialized=!0}setupInfiniteScroll(){this.feedWrapper&&(this.sentinel&&this.sentinel.remove(),this.sentinel=document.createElement("div"),this.sentinel.style.height="20px",this.sentinel.className="scroll-sentinel",this.feedWrapper.appendChild(this.sentinel),this.observer&&this.observer.disconnect(),this.observer=new IntersectionObserver(e=>{e[0].isIntersecting&&this.allPosts.length>0&&this.isInitialized&&this.renderNextPosts()},{rootMargin:"100px"}),this.sentinel&&this.observer.observe(this.sentinel))}cleanupScroll(){this.observer&&(this.observer.disconnect(),this.observer=null),this.sentinel&&(this.sentinel.remove(),this.sentinel=null)}handleStoreChange(){const e=q.getState();this.currentFilter!==e.currentFilter&&(this.currentFilter=e.currentFilter,this.virtualPostIndex=0,this.feedWrapper&&(this.feedWrapper.innerHTML="",this.sentinel&&this.feedWrapper.appendChild(this.sentinel))),e.posts.length>0&&!e.isLoading&&(this.allPosts=[...e.posts],this.feedWrapper&&(this.feedWrapper.innerHTML="",this.sentinel&&this.feedWrapper.appendChild(this.sentinel)),this.virtualPostIndex=0,this.renderNextPosts()),e.error&&this.showError(e.error)}transformPost(e){const t=l.getState(),s=t.user?.id,n=!!s&&s.toString()===e.authorId?.toString();return{postId:e.id||"",authorId:e.authorId,user:{name:e.authorName||"–ê–Ω–æ–Ω–∏–º",subtitle:e.theme||"–ë–ª–æ–≥",avatar:e.authorAvatar||"/img/defaultAvatar.jpg",isSubscribed:!1,id:e.authorId},title:e.title||"",text:e.content||"",image:e.image||"",tags:Array.isArray(e.tags)?e.tags:[],commentsCount:e.commentsCount||0,repostsCount:e.repostsCount||0,viewsCount:e.viewsCount||0,isOwnPost:n,canEdit:n,onMenuAction:t=>this.handlePostAction(t,e.id)}}async renderNextPosts(){if(!this.feedWrapper||0===this.allPosts.length)return;const e=document.createDocumentFragment();let t=0;for(let s=0;s<10&&!(this.virtualPostIndex>=this.allPosts.length);s++){const s=this.allPosts[this.virtualPostIndex],n=this.transformPost(s);try{const r=new M({...n,onMenuAction:e=>this.handlePostAction(e,s.id)}),i=await r.render();e.appendChild(i),t++}catch(e){}this.virtualPostIndex++}t>0&&(this.sentinel?this.feedWrapper.insertBefore(e,this.sentinel):this.feedWrapper.appendChild(e))}showError(e){if(!this.feedWrapper)return;this.feedWrapper.innerHTML="";const t=document.createElement("div");t.className="feed-error",t.textContent=e,this.feedWrapper.appendChild(t)}destroy(){q.removeListener(this.boundStoreHandler),this.cleanupScroll(),this.feedWrapper=null,this.allPosts=[],this.virtualPostIndex=0,this.isInitialized=!1}handlePostAction(e,t){if(t)switch(e){case"edit":c.dispatch("POST_EDIT_REQUEST",{postId:t});break;case"hide":c.dispatch("POST_HIDE_REQUEST",{postId:t});break;case"report":c.dispatch("POST_REPORT_REQUEST",{postId:t})}}}class Q{constructor(){this.feedWrapper=null,this.currentCategory="fresh",this.topBloggersElement=null,this.headerInstance=new U,this.postsView=new W,this.topBloggersInstance=new N,this.determineCurrentCategory()}determineCurrentCategory(){const e=new URL(window.location.href),t=e.pathname;if("/"===t||"/feed"===t)this.currentCategory="fresh";else if("/feed/category"===t){const t=e.searchParams.get("topic");this.currentCategory=t||"fresh"}}async render(){this.determineCurrentCategory();const e=document.createElement("div"),t=document.createElement("header"),s=await this.headerInstance.render(t);t.appendChild(s),e.appendChild(t);const n=document.createElement("div");n.className="content-layout",e.appendChild(n);const r=document.createElement("aside");r.className="sidebar-left";let i=null,o=null;const a=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},c=new T(y,this.currentCategory,e=>{o&&a(o);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render();const d=new T(L,this.currentCategory,e=>{i&&a(i);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});o=await d.render(),r.appendChild(i),r.appendChild(o);const l=document.createElement("main");l.className="main-content",this.feedWrapper=document.createElement("div"),this.feedWrapper.className="feed",this.feedWrapper.id="feed-wrapper",l.appendChild(this.feedWrapper);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggersElement=await this.topBloggersInstance.render(),h.appendChild(this.topBloggersElement),n.appendChild(r),n.appendChild(l),n.appendChild(h);try{await this.postsView.init(this.feedWrapper),console.log("PostsView initialized successfully for category:",this.currentCategory)}catch(e){console.error("Failed to initialize PostsView:",e);const t=document.createElement("div");t.className="feed-error",t.textContent="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–µ–Ω—Ç—É –ø–æ—Å—Ç–æ–≤",this.feedWrapper&&this.feedWrapper.appendChild(t)}return e}destroy(){this.headerInstance.destroy(),this.postsView.destroy()}}let G=null,V=!1;class B{constructor(e){this.props=e}async render(){const e=this.props.posts.map(e=>function(e,t){if(!e)return{};let s=[{key:"hide",text:"–°–∫—Ä—ã—Ç—å"},{key:"report",text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è"}];return t&&(s=[{key:"edit",text:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"},{key:"delete",text:"–£–¥–∞–ª–∏—Ç—å"},...s]),{postId:e.id||"",authorId:e.authorId,user:{name:e.authorName||"–ê–Ω–æ–Ω–∏–º",subtitle:e.theme||"–ë–ª–æ–≥",avatar:e.authorAvatar||"/img/defaultAvatar.jpg",isSubscribed:!1,id:e.authorId},title:e.title||"",text:e.content||"",image:e.image||"",tags:Array.isArray(e.tags)?e.tags:[],commentsCount:e.commentsCount||0,repostsCount:e.repostsCount||0,viewsCount:e.viewsCount||0,isOwnPost:t,canEdit:t,dataPostId:e.id||"",menuItems:s}}(e,this.props.isMyProfile||!1)),t={...this.props,posts:e},s=(await async function(){if(G)return G;await async function(){if(V)return;const e=[{name:"post-card",path:"/components/PostCard/PostCard.hbs"},{name:"input",path:"/components/Input/Input.hbs"},{name:"user-menu",path:"/components/UserMenu/UserMenu.hbs"},{name:"tag",path:"/components/Tag/Tag.hbs"},{name:"icon",path:"/components/Icon/Icon.hbs"},{name:"menu-item",path:"/components/MenuItem/MenuItem.hbs"},{name:"post-card-menu",path:"/components/PostCardMenu/PostCardMenu.hbs"}].map(async e=>{if(!Handlebars.partials[e.name])try{const t=await fetch(e.path);if(t.ok){const s=await t.text();Handlebars.registerPartial(e.name,Handlebars.compile(s))}}catch(e){}});await Promise.all(e),V=!0}(),Handlebars.registerHelper("eq",(e,t)=>e===t),Handlebars.registerHelper("concat",function(...e){return e.pop(),e.join("")});const e=await fetch("/components/Profile/Profile.hbs"),t=await e.text();return G=Handlebars.compile(t),G}())(t),n=document.createElement("div");n.innerHTML=s.trim();const r=n.firstElementChild;if(!r)throw new Error("Profile element not found");return this.initializePostCardMenus(r),r}initializePostCardMenus(e){e.querySelectorAll(".post-card").forEach((e,t)=>{const s=e.querySelector(".post-card__menu-button"),n=e.querySelector(".post-card-menu");if(s&&n){const t=this.extractPostId(e);if(t)try{new x(s,n,t,(e,t)=>{this.handlePostAction(e,t)})}catch(e){}}})}extractPostId(e){if(e.hasAttribute("data-post-id"))return e.getAttribute("data-post-id");const t=e.querySelector("[data-post-id]");if(t)return t.getAttribute("data-post-id");const s=e.id;if(s&&s.startsWith("post-"))return s.replace("post-","");const n=e.querySelector(".post-card__title");if(n&&n.id)return n.id.replace("post-","");const r=e.querySelector(".post-card");return r&&r.hasAttribute("data-post-id")?r.getAttribute("data-post-id"):null}handlePostAction(e,t){switch(e){case"edit":c.dispatch("POST_EDIT_REQUEST",{postId:t});break;case"delete":this.handleDeletePost(t);break;case"hide":c.dispatch("POST_HIDE_REQUEST",{postId:t});break;case"report":c.dispatch("POST_REPORT_REQUEST",{postId:t})}}async handleDeletePost(e){const{DeletePostModal:t}=await Promise.resolve().then(s.bind(s,783)),n=new t,r=await n.render();document.body.appendChild(r),await n.waitForResult()&&(c.dispatch("POST_DELETE_REQUEST",{postId:e}),setTimeout(()=>{c.dispatch("PROFILE_RELOAD_AFTER_DELETE")},500))}}const $=new class extends d{constructor(){super({profile:null,posts:[],comments:[],activeTab:"posts",isLoading:!1,error:null,isEditingDescription:!1,isMyProfile:!1})}registerActions(){this.registerAction("PROFILE_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("PROFILE_LOAD_SUCCESS",e=>{const t=l.getState();let s=!1;e.profile&&t.user&&(s=e.profile.id===t.user.id.toString()),this.setState({profile:e.profile,posts:e.posts,isLoading:!1,error:null,isMyProfile:s})}),this.registerAction("PROFILE_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("POSTS_RELOAD_AFTER_EDIT",()=>{const e=this.getState();e.profile&&c.dispatch("PROFILE_LOAD_REQUEST",{userId:e.profile.id})}),this.registerAction("PROFILE_RELOAD_AFTER_DELETE",()=>{const e=this.getState();e.profile&&c.dispatch("PROFILE_LOAD_REQUEST",{userId:e.profile.id})}),this.registerAction("POSTS_RELOAD_AFTER_CREATE",()=>{const e=this.getState();e.profile&&c.dispatch("PROFILE_LOAD_REQUEST",{userId:e.profile.id})}),this.registerAction("PROFILE_CHANGE_TAB",e=>{this.setState({activeTab:e.tab})}),this.registerAction("PROFILE_CHANGE_TAB",e=>{this.setState({activeTab:e.tab})}),this.registerAction("PROFILE_START_EDIT_DESCRIPTION",()=>{this.setState({isEditingDescription:!0})}),this.registerAction("PROFILE_CANCEL_EDIT_DESCRIPTION",()=>{this.setState({isEditingDescription:!1})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_SUCCESS",e=>{this.state.profile&&this.setState({profile:{...this.state.profile,description:e.description},isLoading:!1,isEditingDescription:!1,error:null})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_FAIL",e=>{this.setState({isLoading:!1,error:e.error})})}};class z{constructor(e,t){this.currentCategory="",this.topBloggers=null,this.pageWrapper=null,this.createPostFormView=null,this.hasRendered=!1,this.sidebarEl1=null,this.sidebarEl2=null,this.isDestroyed=!1,this.container=e,this.headerInstance=new U,this.createPostFormView=new b,t&&t.id?this.userId=t.id:t&&t.query&&t.query.id&&(this.userId=t.query.id),this.boundStoreHandler=this.handleStoreChange.bind(this),this.boundLoginStoreHandler=this.handleLoginStoreChange.bind(this)}async render(){if(this.isDestroyed)return console.warn("‚ö†Ô∏è [PROFILE] Attempted to render destroyed view"),document.createElement("div");if(window.scrollTo(0,0),this.hasRendered&&this.pageWrapper)return this.pageWrapper;this.container.innerHTML="",this.pageWrapper=document.createElement("div");try{return await this.renderPageLayout(),$.addListener(this.boundStoreHandler),l.addListener(this.boundLoginStoreHandler),c.dispatch("PROFILE_LOAD_REQUEST",{userId:this.userId}),this.hasRendered=!0,this.container.appendChild(this.pageWrapper),this.pageWrapper}catch(e){console.error("‚ùå [PROFILE] Error rendering profile:",e);const t=document.createElement("div");return t.textContent="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è",t}}async renderPageLayout(){if(!this.pageWrapper||this.isDestroyed)return void console.error("‚ùå [PROFILE] pageWrapper is null or view destroyed in renderPageLayout");const e=document.createElement("header"),t=await this.headerInstance.render(e);t&&(e.appendChild(t),this.pageWrapper.appendChild(e));const s=document.createElement("div");s.className="content-layout";const n=document.createElement("aside");n.className="sidebar-left";const r=new T(y,"",e=>{c.dispatch("POSTS_SET_FILTER",{filter:e})}),i=new T(L,"",e=>{c.dispatch("POSTS_SET_FILTER",{filter:e})});this.sidebarEl1=await r.render(),this.sidebarEl2=await i.render(),this.sidebarEl1&&n.appendChild(this.sidebarEl1),this.sidebarEl2&&n.appendChild(this.sidebarEl2);const o=document.createElement("main");o.className="main-content";const a=await this.renderProfileContent();a&&o.appendChild(a);const d=document.createElement("aside");d.className="sidebar-right",this.topBloggers=new N;const l=await this.topBloggers.render();l&&d.appendChild(l),s.appendChild(n),s.appendChild(o),s.appendChild(d),this.pageWrapper.appendChild(s)}async renderProfileContent(){if(this.isDestroyed)return document.createElement("div");const e=$.getState(),t=l.getState();if(e.isLoading||!e.profile){const e=document.createElement("div");return e.className="profile",e.innerHTML='\n                <div class="profile__loading">\n                    <div style="text-align: center; padding: 40px;">\n                        <div style="font-size: 18px; margin-bottom: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</div>\n                        <div style="display: inline-block; width: 50px; height: 50px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>\n                    </div>\n                </div>\n            ',e}let s=!1;s=!this.userId||t.user?.id?.toString()===this.userId.toString();const n=new B({profile:e.profile,posts:e.posts,activeTab:e.activeTab,isLoading:e.isLoading,error:e.error,isEditingDescription:e.isEditingDescription,isMyProfile:s}),r=await n.render();return this.attachEventListeners(r),r}handleStoreChange(){if(!this.isDestroyed&&!$.getState().isLoading){const e=this.container.querySelector(".main-content");e&&this.renderProfileContent().then(t=>{!this.isDestroyed&&t&&(e.innerHTML="",e.appendChild(t))})}}handleLoginStoreChange(){this.isDestroyed||l.getState().isLoggedIn||f.navigate("/")}attachEventListeners(e){this.isDestroyed||(e.querySelectorAll("[data-tab]").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.tab;"posts"!==t&&"comments"!==t||c.dispatch("PROFILE_CHANGE_TAB",{tab:t})})}),this.attachPostEditListeners(e),this.attachDescriptionEventListeners(e))}attachPostEditListeners(e){e.querySelectorAll(".post-card__menu-button").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation()})})}attachDescriptionEventListeners(e){const t=e.querySelector(".profile__edit-btn");t&&t.addEventListener("click",()=>{this.startEditingDescription()});const s=e.querySelector(".profile__description-placeholder");s&&s.addEventListener("click",()=>{this.startEditingDescription()});const n=e.querySelector('.form__input[name="description"]');n&&(n.addEventListener("keydown",e=>{const t=e;"Enter"===t.key&&this.saveDescription(t.target.value)}),n.addEventListener("blur",e=>{this.saveDescription(e.target.value)}),n.focus(),n.select())}startEditingDescription(){this.isDestroyed||c.dispatch("PROFILE_START_EDIT_DESCRIPTION")}saveDescription(e){this.isDestroyed||c.dispatch("PROFILE_UPDATE_DESCRIPTION_REQUEST",{description:e.trim()})}destroy(){this.isDestroyed=!0,$.removeListener(this.boundStoreHandler),l.removeListener(this.boundLoginStoreHandler),this.headerInstance&&"function"==typeof this.headerInstance.destroy&&this.headerInstance.destroy(),this.createPostFormView&&"function"==typeof this.createPostFormView.destroy&&(this.createPostFormView.destroy(),this.createPostFormView=null),this.sidebarEl1=null,this.sidebarEl2=null,this.topBloggers=null,this.pageWrapper&&this.pageWrapper.parentNode&&this.pageWrapper.parentNode.removeChild(this.pageWrapper),this.pageWrapper=null,this.hasRendered=!1}}let j=null;class K{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(j)return j;const e=await fetch("/components/Settings/Settings.hbs"),t=await e.text();return j=Handlebars.compile(t),j}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("Settings element not found");return s}}class Z{constructor(e){this.topBloggers=null,this.pageWrapper=null,this.currentCategory="",this.container=e,this.headerInstance=new U,this.boundLoginStoreHandler=this.handleLoginStoreChange.bind(this),this.determineCurrentCategory()}determineCurrentCategory(){const e=new URL(window.location.href),t=e.pathname;if("/"===t||"/feed"===t)this.currentCategory="fresh";else if("/feed/category"===t){const t=e.searchParams.get("topic");this.currentCategory=t||"fresh"}}async render(){return this.determineCurrentCategory(),l.addListener(this.boundLoginStoreHandler),await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const s=document.createElement("div");s.className="content-layout";const n=document.createElement("aside");n.className="sidebar-left";let r=null,i=null;const o=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},a=new T(y,this.currentCategory,e=>{i&&o(i);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await a.render();const c=new T(L,this.currentCategory,e=>{r&&o(r);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render(),n.appendChild(r),n.appendChild(i);const d=document.createElement("main");d.className="main-content";const l=await this.renderSettingsMain();d.appendChild(l);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggers=new N;const u=await this.topBloggers.render();h.appendChild(u),s.appendChild(n),s.appendChild(d),s.appendChild(h),this.pageWrapper.appendChild(s),this.container.appendChild(this.pageWrapper)}async renderSettingsMain(){const e=new K({}),t=await e.render();return this.attachEventListeners(t),t}attachEventListeners(e){e.querySelectorAll(".settings-main__nav-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.route;t&&f.navigate(t)})})}handleLoginStoreChange(){l.getState().isLoggedIn||f.navigate("/")}destroy(){l.removeListener(this.boundLoginStoreHandler),this.headerInstance.destroy()}}let J=null;class Y{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(J)return J;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const s=await fetch("/components/SettingsAccount/SettingsAccount.hbs"),n=await s.text();return Handlebars.registerHelper("eq",function(e,t){return e===t}),J=Handlebars.compile(n),J}())({...this.formatUserData(this.props.userData),userData:this.props.userData,isLoading:this.props.isLoading||!1,error:this.props.error||null}),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("SettingsAccount element not found");return s}formatUserData(e){if(!e)return{name:"",phone:"",email:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",created_at:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",country:"–†–æ—Å—Å–∏—è",language:"–†—É—Å—Å–∫–∏–π",sex:"other",date_of_birth:"",age:"–ù–µ —É–∫–∞–∑–∞–Ω–æ"};let t="–ù–µ —É–∫–∞–∑–∞–Ω–æ";if(e.created_at){const s=new Date(e.created_at);t=s.toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"})+", "+s.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}let s=e.date_of_birth||"",n="–ù–µ —É–∫–∞–∑–∞–Ω–æ";if(e.date_of_birth){const t=new Date(e.date_of_birth);s=t.toISOString().split("T")[0];const r=new Date;let i=r.getFullYear()-t.getFullYear();const o=r.getMonth()-t.getMonth();(o<0||0===o&&r.getDate()<t.getDate())&&i--,n=i.toString()}let r=e.sex;return"male"===e.sex&&(r="male"),"female"===e.sex&&(r="female"),"other"===e.sex&&(r="other"),{name:e.name||"",phone:e.phone||"",email:e.email||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",created_at:t,country:e.country||"–†–æ—Å—Å–∏—è",language:e.language||"–†—É—Å—Å–∫–∏–π",sex:r,date_of_birth:s,age:n}}}const X=new class extends d{constructor(){super({settings:null,isLoading:!1,error:null,isUpdating:!1,isUploadingAvatar:!1,isUploadingCover:!1})}registerActions(){this.registerAction("SETTINGS_ACCOUNT_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("SETTINGS_ACCOUNT_LOAD_SUCCESS",e=>{const t={...e.settings,age:this.calculateAge(e.settings.date_of_birth)};this.setState({settings:t,isLoading:!1,error:null})}),this.registerAction("SETTINGS_ACCOUNT_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_REQUEST",()=>{this.setState({isUpdating:!0,error:null})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_SUCCESS",()=>{this.setState({isUpdating:!1,error:null})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_FAIL",e=>{this.setState({isUpdating:!1,error:e.error})}),this.registerAction("AVATAR_UPLOAD_REQUEST",()=>{this.setState({isUploadingAvatar:!0,error:null})}),this.registerAction("AVATAR_UPLOAD_SUCCESS",()=>{this.setState({isUploadingAvatar:!1,error:null})}),this.registerAction("AVATAR_UPLOAD_FAIL",e=>{this.setState({isUploadingAvatar:!1,error:e.error})}),this.registerAction("AVATAR_DELETE_REQUEST",()=>{this.setState({isUploadingAvatar:!0,error:null})}),this.registerAction("AVATAR_DELETE_SUCCESS",()=>{this.setState({isUploadingAvatar:!1,error:null})}),this.registerAction("AVATAR_DELETE_FAIL",e=>{this.setState({isUploadingAvatar:!1,error:e.error})}),this.registerAction("COVER_UPLOAD_REQUEST",()=>{this.setState({isUploadingCover:!0,error:null})}),this.registerAction("COVER_UPLOAD_SUCCESS",()=>{this.setState({isUploadingCover:!1,error:null})}),this.registerAction("COVER_UPLOAD_FAIL",e=>{this.setState({isUploadingCover:!1,error:e.error})}),this.registerAction("COVER_DELETE_REQUEST",()=>{this.setState({isUploadingCover:!0,error:null})}),this.registerAction("COVER_DELETE_SUCCESS",()=>{this.setState({isUploadingCover:!1,error:null})}),this.registerAction("COVER_DELETE_FAIL",e=>{this.setState({isUploadingCover:!1,error:e.error})})}calculateAge(e){if(!e)return;const t=new Date(e),s=new Date;let n=s.getFullYear()-t.getFullYear();const r=s.getMonth()-t.getMonth();return(r<0||0===r&&s.getDate()<t.getDate())&&n--,n}};let ee=null;class te{constructor(e={}){this.element=null,this.props=e}async render(){const e=(await async function(){if(ee)return ee;const e=await fetch("/components/DeleteAccount/DeleteAccount.hbs"),t=await e.text();return ee=Handlebars.compile(t),ee}())(this.props),t=document.createElement("div");if(t.innerHTML=e.trim(),this.element=t.firstElementChild,!this.element)throw new Error("DeleteAccountModal element not found");return this.setupEventListeners(),this.element}setupEventListeners(){if(!this.element)return;this.element.addEventListener("click",e=>{e.target===this.element&&this.close()});const e=this.element.querySelector(".delete-account-modal__cancel");e&&e.addEventListener("click",()=>{this.close()});const t=this.element.querySelector(".delete-account-modal__delete");t&&t.addEventListener("click",()=>{this.handleDelete()})}close(){this.element&&this.element.parentNode&&this.element.remove()}handleDelete(){const e=this.element?.querySelector(".delete-account-modal__delete");e&&(e.disabled=!0,e.textContent="–£–¥–∞–ª–µ–Ω–∏–µ...");const t=new CustomEvent("accountDeleteRequest");this.element?.dispatchEvent(t)}destroy(){this.element&&this.element.parentNode&&this.element.remove()}}class se{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.deleteModal=null,this.currentCategory="",this.container=e,this.headerInstance=new U,this.boundStoreHandler=this.handleStoreChange.bind(this),this.boundLoginStoreHandler=this.handleLoginStoreChange.bind(this),this.boundFormSubmitHandler=this.handleFormSubmit.bind(this),this.determineCurrentCategory()}determineCurrentCategory(){const e=new URL(window.location.href),t=e.pathname;if("/"===t||"/feed"===t)this.currentCategory="fresh";else if("/feed/category"===t){const t=e.searchParams.get("topic");this.currentCategory=t||"fresh"}}async render(){return this.determineCurrentCategory(),await this.renderFullPage(),X.addListener(this.boundStoreHandler),l.addListener(this.boundLoginStoreHandler),c.dispatch("SETTINGS_ACCOUNT_LOAD_REQUEST"),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const s=document.createElement("div");s.className="content-layout";const n=document.createElement("aside");n.className="sidebar-left";let r=null,i=null;const o=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},a=new T(y,this.currentCategory,e=>{i&&o(i);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await a.render();const c=new T(L,this.currentCategory,e=>{r&&o(r);let t="";t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`,window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render(),n.appendChild(r),n.appendChild(i);const d=document.createElement("main");d.className="main-content";const l=await this.renderAccountContent();d.appendChild(l);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggers=new N;const u=await this.topBloggers.render();h.appendChild(u),s.appendChild(n),s.appendChild(d),s.appendChild(h),this.pageWrapper.appendChild(s),this.container.appendChild(this.pageWrapper)}async renderAccountContent(){const e=X.getState(),t=new Y({userData:e.settings,isLoading:e.isUpdating,error:e.error}),s=await t.render();return this.attachEventListeners(s),s}attachEventListeners(e){const t=e.querySelector(".settings-account__form");t&&t.addEventListener("submit",this.boundFormSubmitHandler);const s=e.querySelector(".settings-account__delete-button");s&&s.addEventListener("click",()=>{this.openDeleteModal()});const n=e.querySelector("#change-avatar-btn"),r=e.querySelector("#delete-avatar-btn"),i=e.querySelector("#avatar-upload");n&&i&&n.addEventListener("click",()=>{i.click()}),i&&i.addEventListener("change",e=>{this.handleAvatarUpload(e)}),r&&r.addEventListener("click",()=>{this.handleAvatarDelete()});const o=e.querySelector("#change-cover-btn"),a=e.querySelector("#delete-cover-btn"),c=e.querySelector("#cover-upload");o&&c&&o.addEventListener("click",()=>{c.click()}),c&&c.addEventListener("change",e=>{this.handleCoverUpload(e)}),a&&a.addEventListener("click",()=>{this.handleCoverDelete()})}async handleAvatarUpload(e){const t=e.target;if(!t.files||0===t.files.length)return;const s=t.files[0];this.clearAvatarError(),s.type.startsWith("image/jpeg")?s.size>5242880?this.showAvatarError("–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB"):(c.dispatch("AVATAR_UPLOAD_REQUEST",{file:s}),t.value=""):this.showAvatarError("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG (JPG)")}handleAvatarDelete(){this.clearAvatarError(),c.dispatch("AVATAR_DELETE_REQUEST")}async handleCoverUpload(e){const t=e.target;if(!t.files||0===t.files.length)return;const s=t.files[0];this.clearCoverError(),s.type.startsWith("image/jpeg")?s.size>5242880?this.showCoverError("–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB"):(c.dispatch("COVER_UPLOAD_REQUEST",{file:s}),t.value=""):this.showCoverError("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG (JPG)")}handleCoverDelete(){this.clearCoverError(),c.dispatch("COVER_DELETE_REQUEST")}showAvatarError(e){this.clearAvatarError();const t=this.pageWrapper?.querySelector(".settings-account__field:nth-child(1)");if(t){const s=document.createElement("div");s.className="field-error",s.textContent=e,t.appendChild(s)}}showCoverError(e){this.clearCoverError();const t=this.pageWrapper?.querySelector(".settings-account__field:nth-child(2)");if(t){const s=document.createElement("div");s.className="field-error",s.textContent=e,t.appendChild(s)}}clearAvatarError(){const e=this.pageWrapper?.querySelector(".settings-account__field:nth-child(1)");if(e){const t=e.querySelector(".field-error");t&&t.remove()}}clearCoverError(){const e=this.pageWrapper?.querySelector(".settings-account__field:nth-child(2)");if(e){const t=e.querySelector(".field-error");t&&t.remove()}}async handleFormSubmit(e){if(e.preventDefault(),!this.pageWrapper)return;const t=this.pageWrapper.querySelector(".settings-account__form");if(!t)return;const s=new FormData(t),n=X.getState(),r={},i=s.get("name")?.trim();i&&(r.name=i);const o=s.get("password")?.trim();o&&(r.password=o);const a=s.get("phone")?.trim(),d=s.get("country")?.trim(),l=s.get("language"),h=s.get("sex"),u=s.get("date_of_birth");void 0!==a&&(r.phone=a||""),void 0!==d&&(r.country=d||""),void 0!==l&&(r.language=l),void 0!==h&&(r.sex=h),void 0!==u&&(r.date_of_birth=u||"");const p=this.validateForm(r);p.length>0?this.showFieldErrors(t,p):c.dispatch("SETTINGS_ACCOUNT_UPDATE_REQUEST",{settings:r,currentSettings:n.settings})}validateForm(e){const t=[];return(!e.name||e.name.trim().length<4)&&t.push({field:"name",message:"–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤"}),e.password&&e.password.length<4&&t.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤"}),e.phone&&!/^\+?[\d\s\-()]+$/.test(e.phone)&&t.push({field:"phone",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞"}),e.date_of_birth&&new Date(e.date_of_birth)>new Date&&t.push({field:"date_of_birth",message:"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º"}),t}showFieldErrors(e,t){this.clearErrors(e),t.forEach(({field:t,message:s})=>{const n=e.querySelector(`[name="${t}"]`);if(!n)return;n.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=s;const i=n.closest(".settings-account__field");i&&i.appendChild(r)})}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}handleLoginStoreChange(){l.getState().isLoggedIn||(l.removeListener(this.boundLoginStoreHandler),f.navigate("/"))}async openDeleteModal(){if(this.deleteModal)return;this.deleteModal=new te;const e=await this.deleteModal.render();e.addEventListener("accountDeleteRequest",()=>{this.handleAccountDelete()}),this.pageWrapper?.appendChild(e)}handleAccountDelete(){c.dispatch("ACCOUNT_DELETE_REQUEST"),this.closeDeleteModal()}closeDeleteModal(){this.deleteModal&&(this.deleteModal.destroy(),this.deleteModal=null)}handleStoreChange(){X.getState().error,this.updateAccountContent()}async updateAccountContent(){if(!this.pageWrapper)return;const e=this.pageWrapper.querySelector(".main-content");if(e){const t=e.querySelector(".settings-account");t&&t.remove();const s=await this.renderAccountContent();e.appendChild(s)}}destroy(){if(X.removeListener(this.boundStoreHandler),l.removeListener(this.boundLoginStoreHandler),this.pageWrapper){const e=this.pageWrapper.querySelector(".settings-account__form");e&&e.removeEventListener("submit",this.boundFormSubmitHandler)}this.deleteModal&&this.deleteModal.destroy(),this.headerInstance.destroy()}}let ne=null;class re{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(ne)return ne;const e=await fetch("/components/SettingsNotifications/SettingsNotifications.hbs"),t=await e.text();return ne=Handlebars.compile(t),ne}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("SettingsNotifications element not found");return s}}class ie{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new U}async render(){return await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const s=document.createElement("div");s.className="content-layout";const n=document.createElement("aside");n.className="sidebar-left";let r=null,i=null;const o=new T(y,"",e=>{const t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await o.render();const a=new T(L,"",e=>{const t=""===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await a.render(),n.appendChild(r),n.appendChild(i);const c=document.createElement("main");c.className="main-content";const d=await this.renderNotificationsContent();c.appendChild(d);const l=document.createElement("aside");l.className="sidebar-right",this.topBloggers=new N;const h=await this.topBloggers.render();l.appendChild(h),s.appendChild(n),s.appendChild(c),s.appendChild(l),this.pageWrapper.appendChild(s),this.container.appendChild(this.pageWrapper)}async renderNotificationsContent(){const e=new re({});return await e.render()}destroy(){this.headerInstance.destroy()}}let oe=null;class ae{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(oe)return oe;const e=await fetch("/components/SettingsPrivacy/SettingsPrivacy.hbs"),t=await e.text();return oe=Handlebars.compile(t),oe}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstElementChild;if(!s)throw new Error("SettingsPrivacy element not found");return s}}class ce{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new U}async render(){return await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const s=document.createElement("div");s.className="content-layout";const n=document.createElement("aside");n.className="sidebar-left";let r=null,i=null;const o=new T(y,"",e=>{const t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await o.render();const a=new T(L,"",e=>{const t=""===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await a.render(),n.appendChild(r),n.appendChild(i);const c=document.createElement("main");c.className="main-content";const d=await this.renderPrivacyContent();c.appendChild(d);const l=document.createElement("aside");l.className="sidebar-right",this.topBloggers=new N;const h=await this.topBloggers.render();l.appendChild(h),s.appendChild(n),s.appendChild(c),s.appendChild(l),this.pageWrapper.appendChild(s),this.container.appendChild(this.pageWrapper)}async renderPrivacyContent(){const e=new ae({});return await e.render()}destroy(){this.headerInstance.destroy()}}const de=new class extends d{constructor(){super({post:null,isLoading:!1,error:null})}registerActions(){this.registerAction("POST_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null,post:null})}),this.registerAction("POST_LOAD_SUCCESS",e=>{this.setState({post:e.post,isLoading:!1,error:null})}),this.registerAction("POST_LOAD_FAIL",e=>{this.setState({post:null,isLoading:!1,error:e.error})})}};class le{constructor(e,t){this.postCard=null,this.container=e,this.postId=t.id,this.headerInstance=new U,this.boundStoreHandler=this.handleStoreChange.bind(this),de.addListener(this.boundStoreHandler)}async render(){c.dispatch("POST_LOAD_REQUEST",{postId:this.postId});const e=document.createElement("div"),t=document.createElement("header"),s=await this.headerInstance.render(t);t.appendChild(s),e.appendChild(t);const n=document.createElement("div");n.className="content-layout",e.appendChild(n);const r=document.createElement("aside");r.className="sidebar-left";let i=null,o=null;const a=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},d=new T(y,"",e=>{o&&a(o);const t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await d.render();const l=new T(L,"",e=>{i&&a(i);const t="fresh"===e?"/feed":`/feed/category?topic=${encodeURIComponent(e)}&offset=0`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});o=await l.render(),r.appendChild(i),r.appendChild(o);const h=document.createElement("main");h.className="main-content";const u=document.createElement("div");u.className="post-wrapper",u.id="post-wrapper",u.innerHTML='\n            <div class="post-view__loader" style="text-align: center; padding: 40px;">\n                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞...\n            </div>\n        ',h.appendChild(u);const p=document.createElement("aside");p.className="sidebar-right";const m=new N,g=await m.render();return p.appendChild(g),n.appendChild(r),n.appendChild(h),n.appendChild(p),e}handleStoreChange(){const e=de.getState(),t=document.getElementById("post-wrapper");t&&(e.isLoading?t.innerHTML='\n                <div class="post-view__loader" style="text-align: center; padding: 40px;">\n                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞...\n                </div>\n            ':e.error?t.innerHTML=`\n                <div class="post-view__error" style="text-align: center; padding: 40px; color: var(--text-failure);">\n                    ${e.error}\n                </div>\n            `:e.post&&this.renderPostInWrapper(e.post,t))}async renderPostInWrapper(e,t){const s=l.getState(),n=s.user?.id,r=!!n&&n.toString()===e.authorId.toString(),i={postId:e.id,authorId:e.authorId,user:{name:e.authorName||"–ê–Ω–æ–Ω–∏–º",subtitle:e.theme||"–ë–ª–æ–≥",avatar:e.authorAvatar||"/img/defaultAvatar.jpg",isSubscribed:!1,id:e.authorId},title:e.title||"",text:e.content||"",tags:Array.isArray(e.tags)?e.tags:[],commentsCount:e.commentsCount||0,repostsCount:e.repostsCount||0,viewsCount:e.viewsCount||0,isOwnPost:r};try{this.postCard=new M(i);const e=await this.postCard.render();t.innerHTML="",t.appendChild(e)}catch(e){t.innerHTML='\n                <div class="post-view__error" style="text-align: center; padding: 40px; color: var(--text-failure);">\n                    –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–æ—Å—Ç\n                </div>\n            '}}destroy(){this.headerInstance.destroy(),de.removeListener(this.boundStoreHandler)}}(async function(){f.addRoute("/",Q,"Mindleak - –ì–ª–∞–≤–Ω–∞—è"),f.addRoute("/feed",Q,"Mindleak - –õ–µ–Ω—Ç–∞"),f.addRoute("/feed/category",Q,"Mindleak - –ö–∞—Ç–µ–≥–æ—Ä–∏—è"),f.addRoute("/feed/category",W,"–ö–∞—Ç–µ–≥–æ—Ä–∏—è"),f.addRoute("/post/:id",le,"Mindleak - –ü–æ—Å—Ç"),f.addRoute("/profile",z,"Mindleak - –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",!0),f.addRoute("/profile/:id",z,"Mindleak - –ü—Ä–æ—Ñ–∏–ª—å",!0),f.addRoute("/settings",Z,"Mindleak - –ù–∞—Å—Ç—Ä–æ–π–∫–∏",!0),f.addRoute("/settings/account",se,"Mindleak - –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å",!0),f.addRoute("/settings/notifications",ie,"Mindleak - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",!0),f.addRoute("/settings/privacy",ce,"Mindleak - –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",!0),f.init()})().catch(console.error)})();