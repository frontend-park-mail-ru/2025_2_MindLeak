(()=>{"use strict";const e=new class{constructor(){this.routes=[],this.currentView=null,this.isInitialized=!1,this.handleRouteChange=this.handleRouteChange.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this)}addRoute(e,t,n){this.routes.push({path:e,view:t,title:n})}init(){this.isInitialized||(window.addEventListener("popstate",this.handleRouteChange),document.addEventListener("click",this.handleLinkClick),this.handleRouteChange(),this.isInitialized=!0,console.log("Router initialized"))}async handleRouteChange(){const e=window.location.pathname;await this.navigate(e,!1)}handleLinkClick(e){const t=e.target.closest("a[href]");if(!t)return;const n=t.getAttribute("href");!n||n.startsWith("http")||n.startsWith("mailto:")||n.startsWith("tel:")||n.startsWith("#")||(t.hasAttribute("data-router-ignore")?console.log("Ignoring link with data-router-ignore:",n):(e.preventDefault(),this.navigate(n)))}async navigate(e,t=!0){const n="/"===e?"/":`/${e.replace(/^\/+/,"")}`;t&&window.history.pushState({},"",n);const s=this.findRoute(n);s?await this.renderView(s,n):await this.show404()}findRoute(e){console.log(`[Router] Finding route for: ${e}`);const t=this.routes.find(t=>t.path===e);if(t)return console.log(`[Router] Exact match found: ${t.path}`),t;for(const t of this.routes)if(t.path.includes(":")){const n=this.pathToRegex(t.path);if(e.match(n))return console.log(`[Router] Pattern match found: ${t.path} for ${e}`),t}return console.log(`[Router] No route found for: ${e}`),null}extractParams(e,t){const n={},s=e.split("/"),r=t.split("/");for(let e=0;e<s.length;e++)s[e].startsWith(":")&&(n[s[e].slice(1)]=r[e]);return n}pathToRegex(e){const t=e.replace(/:\w+/g,"([^/]+)");return new RegExp(`^${t}$`)}async renderView(e,t){this.currentView&&"function"==typeof this.currentView.destroy&&this.currentView.destroy(),e.title&&(document.title=e.title);try{const n=e.view;let s={};t&&e.path.includes(":")&&(s=this.extractParams(e.path,t));const r=document.getElementById("root");if(r&&(this.currentView=new n(r,s),r.innerHTML="","function"==typeof this.currentView.render)){const e=await this.currentView.render();r.appendChild(e)}console.log(`Rendered view for route: ${e.path}`,s)}catch(e){console.error("Error rendering view:",e),await this.show404()}}async show404(){const e=document.getElementById("root");e&&(e.innerHTML='\n            <div style="text-align: center; padding: 50px;">\n            <h1>404 - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h1>\n            <p>–ó–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.</p>\n            <a href="/" data-router-link>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>\n            </div>\n        ')}destroy(){window.removeEventListener("popstate",this.handleRouteChange),document.removeEventListener("click",this.handleLinkClick),this.currentView&&"function"==typeof this.currentView.destroy&&this.currentView.destroy(),this.isInitialized=!1}},t=new class{async request(e,t={}){try{const n=`https://mindleak.ru/api${e}`;console.log(`AJAX Making request to: ${n}`,t);const s=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},credentials:"include",...t}),r=s.headers.get("content-type");let i=null;if(r&&r.includes("application/json"))try{i=await s.json()}catch(t){console.warn(`AJAX Failed to parse JSON from ${e}:`,t)}const o={status:s.status,data:i,message:s.statusText};return console.log(`AJAX Response from ${e}:`,o),o}catch(t){return console.error(`AJAX Network error for ${e}:`,t),{status:0,message:"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º üò≠"}}}async get(e){return this.request(e)}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e,t){return this.request(e,{method:"DELETE",body:t?JSON.stringify(t):void 0})}async getMe(){return this.get("/me")}async login(e){return this.post("/login",e)}async register(e){return this.post("/registration",e)}async logout(){return this.get("/logout")}getFeed(e){const t=e?`/feed?filter=${encodeURIComponent(e)}`:"/feed";return this.get(t)}async createPost(e){return this.post("/posts",e)}async deletePost(e){return this.request(e,{method:"DELETE"})}async deleteAccount(){return this.delete("/profile/delete")}async editPost(e,t){return this.put(`/posts/${e}`,t)}},n=200,s=401,r=new class{handleAction(e,t){switch(console.log(`API action: ${e}`,t),e){case"LOGIN_CHECK_REQUEST":this.checkAuth();break;case"LOGIN_REQUEST":this.login(t.email,t.password);break;case"LOGOUT_REQUEST":this.logout();break;case"SIGNUP_REQUEST":this.signUp(t.name,t.email,t.password);break;case"POSTS_LOAD_REQUEST":this.loadPosts(t?.filter);break;case"POST_LOAD_REQUEST":this.loadPost(t.postId);break;case"PROFILE_LOAD_REQUEST":this.loadProfile(t.userId);break;case"PROFILE_UPDATE_DESCRIPTION_REQUEST":this.updateProfileDescription(t.description);break;case"SETTINGS_ACCOUNT_LOAD_REQUEST":this.loadSettingsAccount();break;case"SETTINGS_ACCOUNT_UPDATE_REQUEST":case"EDIT_PROFILE_UPDATE_REQUEST":this.updateSettingsAccount(t.settings);break;case"ACCOUNT_DELETE_REQUEST":this.deleteAccount();case"CREATE_POST_REQUEST":this.createPost(t);break;case"POST_DELETE_REQUEST":this.deletePost(t.postId);break;case"POST_EDIT_REQUEST":this.loadPostForEdit(t.postId);break;case"EDIT_POST_REQUEST":this.editPost(t.postId,t)}}sendAction(e,t){i.dispatch(e,t)}async checkAuth(){const e=await t.getMe();switch(e.status){case n:if(e.data){const t={id:e.data.id,name:e.data.name,avatar:e.data.avatar||"/img/defaultAvatar.jpg",subtitle:e.data.subtitle||"–ë–ª–æ–≥"};this.sendAction("USER_LOGIN_CHECKED",{user:t})}else this.sendAction("USER_LOGIN_FAIL",{error:"No user data"});break;case s:this.sendAction("USER_LOGIN_FAIL",{error:"Not authenticated"});break;default:this.sendAction("USER_LOGIN_FAIL",{error:e.message||"Auth check failed"})}}async login(e,r){const i=await t.login({email:e,password:r});switch(i.status){case n:if(i.data){const e={id:i.data.id,name:i.data.name,avatar:i.data.avatar||"/img/defaultAvatar.jpg",subtitle:i.data.subtitle||"–ë–ª–æ–≥"};this.sendAction("USER_LOGIN_SUCCESS",{user:e})}else this.sendAction("USER_LOGIN_FAIL",{error:"No user data in response"});break;case s:case 400:case 404:this.sendAction("USER_LOGIN_FAIL",{error:"Email –∏–ª–∏ –ø–∞—Ä–æ–ª—å —É–∫–∞–∑–∞–Ω—ã –Ω–µ–≤–µ—Ä–Ω–æ"});break;default:this.sendAction("USER_LOGIN_FAIL",{error:i.data?.error||i.message||"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"})}}async logout(){(await t.logout()).status===n?this.sendAction("USER_LOGOUT"):this.sendAction("USER_LOGOUT_FAIL",{error:"Logout failed"})}async editPost(e,n){const s=await t.editPost(e,{title:n.title,content:n.content,theme:n.theme});200===s.status?(this.sendAction("EDIT_POST_SUCCESS"),this.sendAction("POSTS_RELOAD_AFTER_EDIT")):this.sendAction("EDIT_POST_FAIL",{error:s.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å—Ç"})}async loadPostForEdit(e){const n=await t.get(`/posts/${e}`);200===n.status&&n.data?this.sendAction("POST_EDIT_LOAD_SUCCESS",{post:n.data}):this.sendAction("POST_EDIT_LOAD_FAIL",{error:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å—Ç"})}async signUp(e,s,r){const i=await t.register({name:e,email:s,password:r});switch(i.status){case n:case 201:this.sendAction("USER_SIGNUP_SUCCESS");break;case 409:this.sendAction("USER_SIGNUP_FAIL",{error:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"});break;default:this.sendAction("USER_SIGNUP_FAIL",{error:i.data?.globalError||i.message||"–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"})}}async loadPosts(e){const r=await t.getFeed(e);switch(r.status){case n:if(r.data){const e=r.data.map(e=>({...e,author_id:e.author_id||e.authorId||null}));this.sendAction("POSTS_LOAD_SUCCESS",{posts:e})}else this.sendAction("POSTS_LOAD_FAIL",{error:"No posts data"});break;case 204:this.sendAction("POSTS_LOAD_FAIL",{error:"No more content"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("POSTS_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("POSTS_LOAD_FAIL",{error:r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤"})}}async loadPost(e){const r=await t.get(`/posts/${e}`);switch(r.status){case n:r.data?this.sendAction("POST_LOAD_SUCCESS",{post:r.data}):this.sendAction("POST_LOAD_FAIL",{error:"Post data is empty"});break;case 404:this.sendAction("POST_LOAD_FAIL",{error:"–ü–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("POST_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("POST_LOAD_FAIL",{error:r.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞"})}}async loadProfile(e){let r="/profile";e&&(r=`/user?id=${e}`);const i=await t.get(r);switch(i.status){case n:if(i.data){const e={id:i.data.id,name:i.data.name,email:i.data.email,avatar:i.data.avatar||"/img/defaultAvatar.jpg",cover:i.data.cover||"/img/defaultCover.jpg",description:i.data.description,subscribersCount:i.data.subscribers_count||0,subscriptionsCount:i.data.subscriptions_count||0,postsCount:i.data.posts_count||0,isSubscribed:i.data.is_subscribed||!1},t=i.data.posts||[];this.sendAction("PROFILE_LOAD_SUCCESS",{profile:e,posts:t})}else this.sendAction("PROFILE_LOAD_FAIL",{error:"No profile data"});break;case 404:this.sendAction("PROFILE_LOAD_FAIL",{error:"–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("PROFILE_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("PROFILE_LOAD_FAIL",{error:i.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è"})}}async updateProfileDescription(e){const r=await t.post("/profile",{description:e});switch(r.status){case n:this.sendAction("PROFILE_UPDATE_DESCRIPTION_SUCCESS",{description:e});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("PROFILE_UPDATE_DESCRIPTION_FAIL",{error:"Not authenticated"});break;default:this.sendAction("PROFILE_UPDATE_DESCRIPTION_FAIL",{error:r.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è"})}}async loadSettingsAccount(){const e=await t.get("/profile");switch(e.status){case n:if(e.data){const t={phone:e.data.phone||"",country:e.data.country||"–†–æ—Å—Å–∏—è",language:e.data.language||"–†—É—Å—Å–∫–∏–π",sex:e.data.sex||"other",date_of_birth:e.data.date_of_birth||"",cover:e.data.cover||"/img/defaultCover.jpg",name:e.data.name||"",avatar_url:e.data.avatar_url||"/img/defaultAvatar.jpg",email:e.data.email||"",created_at:e.data.created_at||""};this.sendAction("SETTINGS_ACCOUNT_LOAD_SUCCESS",{settings:t})}else this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:"No settings data"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:"Not authenticated"});break;default:this.sendAction("SETTINGS_ACCOUNT_LOAD_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"})}}async updateSettingsAccount(e){const r=await t.put("/profile",e);switch(r.status){case n:if(r.data){const e={phone:r.data.phone||"",country:r.data.country||"–†–æ—Å—Å–∏—è",language:r.data.language||"–†—É—Å—Å–∫–∏–π",sex:r.data.sex||"other",date_of_birth:r.data.date_of_birth||"",cover:r.data.cover||"/img/defaultCover.jpg",name:r.data.name||"",avatar_url:r.data.avatar_url||"/img/defaultAvatar.jpg",email:r.data.email||"",created_at:r.data.created_at||""};this.sendAction("SETTINGS_ACCOUNT_UPDATE_SUCCESS",{settings:e})}else this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:"No updated data"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("SETTINGS_ACCOUNT_UPDATE_FAIL",{error:r.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"})}}async deleteAccount(){const e=await t.deleteAccount();switch(e.status){case n:this.sendAction("ACCOUNT_DELETE_SUCCESS"),this.sendAction("USER_LOGOUT");break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("ACCOUNT_DELETE_FAIL",{error:"Not authenticated"});break;default:this.sendAction("ACCOUNT_DELETE_FAIL",{error:e.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞"})}}async createPost(e){const r=await t.createPost(e);switch(r.status){case n:case 201:r.data?(this.sendAction("CREATE_POST_SUCCESS",r.data),this.sendAction("POSTS_RELOAD_AFTER_CREATE")):this.sendAction("CREATE_POST_FAIL",{error:"–ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã"});break;case 400:this.sendAction("CREATE_POST_FAIL",{error:r.data?.globalError||r.data?.message||"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞"});break;case s:this.sendAction("USER_UNAUTHORIZED"),this.sendAction("CREATE_POST_FAIL",{error:"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤"});break;default:this.sendAction("CREATE_POST_FAIL",{error:r.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç"})}}async deletePost(e){200===(await t.deletePost(`/posts/${e}`)).status?(this.sendAction("POST_DELETE_SUCCESS",{postId:e}),this.sendAction("POSTS_RELOAD_AFTER_DELETE")):this.sendAction("POST_DELETE_FAIL",{error:"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç"})}},i=new class{constructor(){this.callbacks={}}register(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}dispatch(e,t){console.log(`[Dispatcher] Dispatching: ${e}`,t),r.handleAction(e,t),(this.callbacks[e]||[]).forEach(n=>{try{n(t)}catch(t){console.error(`Error in callback for ${e}:`,t)}})}unregister(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter(e=>e!==t))}};let o=null;class a{constructor({user:e,menuItems:t}){this.user=e,this.menuItems=t||[{key:"bookmarks",icon:"/img/icons/note_icon.svg",text:"–ß–µ—Ä–Ω–æ–≤–∏–∫–∏"},{key:"saved",icon:"/img/icons/bookmark.svg",text:"–ó–∞–∫–ª–∞–¥–∫–∏"},{key:"settings",icon:"/img/icons/settings_icon.svg",text:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"subscription",icon:"/img/icons/premium_icon.svg",text:"–ü–æ–¥–ø–∏—Å–∫–∞"},{key:"logout",icon:"/img/icons/exit_icon.svg",text:"–í—ã–π—Ç–∏"}]}async render(){const e=(await async function(){if(o)return o;const e=await fetch("/components/UserMenu/UserMenu.hbs"),t=await e.text();Handlebars.registerPartial("user-menu",Handlebars.compile(t));const n=await fetch("/components/MenuItem/MenuItem.hbs"),s=await n.text();Handlebars.registerPartial("menu-item",Handlebars.compile(s));const r=await fetch("/components/PopUpMenu/PopUpMenu.hbs"),i=await r.text();return o=Handlebars.compile(i),o}())({user:this.user,menuItems:this.menuItems}),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Popup menu element not found");const s=n.querySelector(".user-menu");return s&&(s.style.cursor="pointer",s.addEventListener("click",e=>{e.preventDefault(),console.log("[PopUpMenu] –ö–ª–∏–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é - –ø–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å"),n.parentNode&&n.remove(),window.history.pushState({},"","/profile"),window.dispatchEvent(new PopStateEvent("popstate"))})),n.querySelectorAll(".menu-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const s=e.dataset.key;switch(console.log(`[PopUpMenu] –ö–ª–∏–∫ –ø–æ –ø—É–Ω–∫—Ç—É: ${s}`),n.parentNode&&n.remove(),s){case"logout":!async function(){console.log("–ü–æ–ø—ã—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Flux...");try{i.dispatch("LOGOUT_REQUEST")}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:",e)}}();break;case"settings":console.log("[PopUpMenu] –ü–µ—Ä–µ—Ö–æ–¥ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"),window.history.pushState({},"","/settings"),window.dispatchEvent(new PopStateEvent("popstate"));break;case"profile":console.log("[PopUpMenu] –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å"),window.history.pushState({},"","/profile"),window.dispatchEvent(new PopStateEvent("popstate"));break;default:console.log(`[PopUpMenu] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É–Ω–∫—Ç–∞: ${s}`)}})}),n.addEventListener("click",e=>{e.stopPropagation()}),n}}class c{constructor(e){this.listeners=[],this.state=e,this.registerActions()}getState(){return{...this.state}}setState(e){this.state={...this.state,...e},this.emitChange()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)}emitChange(){this.listeners.forEach(e=>e())}registerAction(e,t){i.register(e,t)}}const l=new class extends c{constructor(){super({isLoggedIn:!1,user:null,isLoading:!1,error:null})}registerActions(){this.registerAction("LOGIN_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("USER_LOGIN_START",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("USER_LOGIN_SUCCESS",e=>{this.setState({isLoggedIn:!0,user:e.user,isLoading:!1,error:null})}),this.registerAction("USER_LOGIN_FAIL",e=>{this.setState({isLoggedIn:!1,user:null,isLoading:!1,error:e.error})}),this.registerAction("USER_LOGOUT",()=>{this.setState({isLoggedIn:!1,user:null,error:null})}),this.registerAction("USER_LOGIN_CHECKED",e=>{this.setState({isLoggedIn:!!e.user,user:e.user,isLoading:!1})})}};let d=null;class h{async render(){const e=(await async function(){if(d)return d;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const n=await fetch("/components/FormButton/FormButton.hbs"),s=await n.text();Handlebars.registerPartial("button",Handlebars.compile(s));const r=await fetch("/components/LoginForm/LoginForm.hbs"),i=await r.text();return d=Handlebars.compile(i),d}())({}),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Modal element not found");return n.addEventListener("click",e=>{e.target===n&&n.remove()}),n}getFormElement(e){return e.querySelector(".login-form__body")}getSignUpLink(e){return e.querySelector(".login-form__footer .link")}}let u=null;class p{async render(){const e=(await async function(){if(u)return u;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const n=await fetch("/components/FormButton/FormButton.hbs"),s=await n.text();Handlebars.registerPartial("button",Handlebars.compile(s));const r=await fetch("/components/SignUpForm/SignUpForm.hbs"),i=await r.text();return u=Handlebars.compile(i),u}())({}),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Modal element not found");return n.addEventListener("click",e=>{e.target===n&&n.remove()}),n}getFormElement(e){return e.querySelector(".registration-form__body")}getLoginLink(e){return e.querySelector(".registration-form__footer .link")}}const m=new class extends c{constructor(){super({isLoading:!1,error:null,fieldErrors:[],isSuccess:!1})}registerActions(){this.registerAction("SIGNUP_REQUEST",()=>{this.setState({isLoading:!0,error:null,fieldErrors:[],isSuccess:!1})}),this.registerAction("USER_SIGNUP_SUCCESS",()=>{this.setState({isLoading:!1,error:null,fieldErrors:[],isSuccess:!0})}),this.registerAction("USER_SIGNUP_FAIL",e=>{this.setState({isLoading:!1,error:e.error||null,fieldErrors:e.fieldErrors||[],isSuccess:!1})}),this.registerAction("SIGNUP_RESET",()=>{this.setState({isLoading:!1,error:null,fieldErrors:[],isSuccess:!1})})}};class g{constructor(){this.formElement=null,this.signUpForm=new p,this.boundStoreHandler=this.handleStoreChange.bind(this),this.init()}init(){m.addListener(this.boundStoreHandler)}async render(){return this.formElement=await this.signUpForm.render(),this.setupEventHandlers(),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector(".registration-form__body");if(e){const t=e.cloneNode(!0);e.parentNode?.replaceChild(t,e),t.addEventListener("submit",this.handleSubmit.bind(this)),this.setupPasswordToggles(t)}const t=this.formElement.querySelector(".registration-form__footer .link");t&&t.addEventListener("click",this.handleLoginClick.bind(this))}setupPasswordToggles(e){const t=e.querySelectorAll(".password-toggle"),n=e.querySelectorAll('input[type="password"]');t.forEach((e,t)=>{e.addEventListener("click",()=>{const s=n[t];"password"===s.type?(s.type="text",e.textContent="üôà"):(s.type="password",e.textContent="üôâ")})})}async handleSubmit(e){if(e.preventDefault(),!this.formElement)return;const t=this.formElement.querySelector(".registration-form__body"),n=new FormData(t),s=n.get("username"),r=n.get("email")?.trim(),o=n.get("password"),a=n.get("confirmPassword");this.clearErrors(t);const c=[];s?(s.length<4||/\s/.test(s))&&c.push({field:"username",message:"–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):c.push({field:"username",message:"–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"}),r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)||c.push({field:"email",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"}):c.push({field:"email",message:"Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),o?(o.length<4||/\s/.test(o))&&c.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):c.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),a?o!==a&&c.push({field:"confirmPassword",message:"–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"}):c.push({field:"confirmPassword",message:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"}),c.length>0?this.showFieldErrors(t,c):i.dispatch("SIGNUP_REQUEST",{name:s,email:r,password:o})}handleStoreChange(){const e=m.getState();if(e.error&&this.formElement){const t=this.formElement.querySelector(".registration-form__body");this.showFieldErrors(t,[{field:"email",message:e.error}])}if(e.fieldErrors&&this.formElement){const t=this.formElement.querySelector(".registration-form__body");this.showFieldErrors(t,e.fieldErrors)}e.isSuccess&&this.formElement&&(this.destroy(),window.location.reload())}showFieldErrors(e,t){t.forEach(({field:t,message:n})=>{const s=e.querySelector(`input[name="${t}"]`);if(!s)return;s.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=n;const i=s.closest(".input-wrapper");i?i.parentNode.insertBefore(r,i.nextSibling):s.parentNode.insertBefore(r,s.nextSibling)})}showGlobalError(e,t){const n=document.createElement("div");n.className="global-error",n.textContent=t,e.appendChild(n)}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}handleLoginClick(e){e.preventDefault(),this.destroy(),(new E).render().then(e=>{document.body.appendChild(e)})}destroy(){m.removeListener(this.boundStoreHandler),this.formElement&&this.formElement.parentNode&&this.formElement.remove()}}class E{constructor(){this.formElement=null,this.loginForm=new h,this.boundStoreHandler=this.handleStoreChange.bind(this),this.init()}init(){l.addListener(this.boundStoreHandler)}async render(){return this.formElement=await this.loginForm.render(),this.setupEventHandlers(),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector(".login-form__body");if(e){const t=e.cloneNode(!0);e.parentNode?.replaceChild(t,e),t.addEventListener("submit",this.handleSubmit.bind(this)),this.setupPasswordToggle(t)}const t=this.formElement.querySelector(".login-form__footer .link");t&&t.addEventListener("click",this.handleSignUpClick.bind(this))}setupPasswordToggle(e){const t=e.querySelector(".password-toggle"),n=e.querySelector('input[name="password"]');t&&n&&t.addEventListener("click",()=>{"password"===n.type?(n.type="text",t.textContent="üôà"):(n.type="password",t.textContent="üôâ")})}async handleSubmit(e){if(e.preventDefault(),!this.formElement)return;const t=this.formElement.querySelector(".login-form__body"),n=new FormData(t),s=n.get("email")?.trim(),r=n.get("password");console.log("Login attempt with:",{email:s,password:r}),this.clearErrors(t);const o=[];s?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||o.push({field:"email",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"}):o.push({field:"email",message:"Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),r?(r.length<4||/\s/.test(r))&&o.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"}):o.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}),o.length>0?this.showFieldErrors(t,o):i.dispatch("LOGIN_REQUEST",{email:s,password:r})}handleStoreChange(){const e=l.getState();if(e.error&&this.formElement){const t=this.formElement.querySelector(".login-form__body");this.showFieldErrors(t,[{field:"email",message:e.error}])}e.isLoggedIn&&this.formElement&&(this.destroy(),window.location.reload())}showFieldErrors(e,t){t.forEach(({field:t,message:n})=>{const s=e.querySelector(`input[name="${t}"]`);if(!s)return;s.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=n;const i=s.closest(".input-wrapper");i?i.parentNode.insertBefore(r,i.nextSibling):s.parentNode.insertBefore(r,s.nextSibling)})}showGlobalError(e,t){const n=document.createElement("div");n.className="global-error",n.textContent=t,e.appendChild(n)}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}handleSignUpClick(e){e.preventDefault(),this.destroy(),(new g).render().then(e=>{document.body.appendChild(e)})}destroy(){l.removeListener(this.boundStoreHandler),this.formElement&&this.formElement.parentNode&&this.formElement.remove()}}const S=new class extends c{constructor(){super({draftTitle:"",draftContent:"",currentTheme:"–ë–µ–∑ —Ç–µ–º—ã",currentThemeKey:null,isCreating:!1,success:!1,error:null,isEditing:!1,editingPostId:null})}registerActions(){this.registerAction("CREATE_POST_FORM_INIT",()=>{this.setState({draftTitle:"",draftContent:"",currentTheme:"–ë–µ–∑ —Ç–µ–º—ã",currentThemeKey:null,isCreating:!1,success:!1,error:null,isEditing:!1,editingPostId:null})}),this.registerAction("POST_TITLE_CHANGED",e=>{this.setState({draftTitle:e.title})}),this.registerAction("POST_CONTENT_CHANGED",e=>{this.setState({draftContent:e.content})}),this.registerAction("THEME_SELECTED",e=>{this.setState({currentTheme:e.theme,currentThemeKey:e.key})}),this.registerAction("POST_EDIT_LOAD_SUCCESS",e=>{this.setState({draftTitle:e.post.title||"",draftContent:e.post.content||"",currentTheme:e.post.theme||"–ë–µ–∑ —Ç–µ–º—ã",currentThemeKey:e.post.theme||null,isEditing:!0,editingPostId:e.post.id})}),this.registerAction("CREATE_POST_REQUEST",()=>{this.setState({isCreating:!0,error:null})}),this.registerAction("CREATE_POST_SUCCESS",()=>{this.setState({isCreating:!1,success:!0,error:null})}),this.registerAction("CREATE_POST_FAIL",e=>{this.setState({isCreating:!1,success:!1,error:e.error})}),this.registerAction("EDIT_POST_REQUEST",()=>{this.setState({isCreating:!0,error:null})}),this.registerAction("EDIT_POST_SUCCESS",()=>{this.setState({isCreating:!1,success:!0,error:null,isEditing:!1,editingPostId:null})}),this.registerAction("EDIT_POST_FAIL",e=>{this.setState({isCreating:!1,error:e.error})})}};let f=null;const w=[{key:"fresh",icon:"/img/icons/Fresh_icon.svg",text:"–°–≤–µ–∂–µ–µ"},{key:"trends",icon:"/img/icons/trends_icon.svg",text:"–¢—Ä–µ–Ω–¥—ã"},{key:"feed",icon:"/img/icons/feed_icon.svg",text:"–õ–µ–Ω—Ç–∞"},{key:"messages",icon:"/img/icons/chat_icon.svg",text:"–°–æ–æ–±—â–µ–Ω–∏—è"}],_=[{key:"services",icon:"/img/icons/services_icon.svg",text:"–°–µ—Ä–≤–∏—Å—ã"},{key:"marketing",icon:"/img/icons/marketing_icon.svg",text:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},{key:"money",icon:"/img/icons/money_icon.svg",text:"–î–µ–Ω—å–≥–∏"},{key:"travel",icon:"/img/icons/travel_icon.svg",text:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"},{key:"ai",icon:"/img/icons/AI_icon.svg",text:"AI"},{key:"personal-exp",icon:"/img/icons/person-exp_icon.svg",text:"–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç"},{key:"invest",icon:"/img/icons/invest_icon.svg",text:"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"},{key:"career",icon:"/img/icons/career_icon.svg",text:"–ö–∞—Ä—å–µ—Ä–∞"},{key:"edu",icon:"/img/icons/edu_icon.svg",text:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"}];class C{constructor(e,t="fresh",n=()=>{}){this.menuItems=e,this.currentActiveKey=t,this.onSelect=n}async render(){const e=(await async function(){if(f)return f;const e=await fetch("/components/MenuItem/MenuItem.hbs"),t=await e.text();Handlebars.registerPartial("menu-item",Handlebars.compile(t));const n=await fetch("/components/SidebarMenu/SidebarMenu.hbs"),s=await n.text();return f=Handlebars.compile(s),f}())({menuItems:this.menuItems}),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Sidebar element not found");const s=e=>{this.currentActiveKey=e,n.querySelectorAll(".menu-item").forEach(t=>{t.classList.toggle("menu-item--active",t.dataset.key===e)})};return s(this.currentActiveKey),n.querySelectorAll(".menu-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.key;n&&(console.log(`[Sidebar] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª: ${n}`),s(n),this.onSelect(n))})}),n}}let A=null;class L{constructor(e){this.onSelect=e,this.popupElement=null}async render(){const e=document.createElement("div");e.className="theme-selector-popup";const t=new C(_,"",e=>{this.onSelect(e),this.close()}),n=await t.render();return n.classList.add("theme-selector-popup__menu"),e.appendChild(n),document.addEventListener("click",t=>{e.contains(t.target)||this.close()},{once:!0}),document.body.appendChild(e),this.popupElement=e,e}close(){this.popupElement?.parentNode&&this.popupElement.remove(),this.popupElement=null}}class y{constructor(){this.formElement=null,this.maxChars=5e3,this.boundStoreHandler=this.handleStoreChange.bind(this),S.addListener(this.boundStoreHandler)}handleStoreChange(){const e=S.getState();e.success&&(this.close(),i.dispatch("SHOW_NOTIFICATION",{type:"success",message:"–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!"})),e.error&&this.showError(e.error),this.updateUIFromState(e)}updateUIFromState(e){if(!this.formElement)return;const t=this.formElement.querySelector('[data-key="submit-post"]');t&&(t.disabled=e.isCreating,t.textContent=e.isCreating?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å");const n=this.formElement.querySelector(".user-menu__subtitle");n&&(n.textContent=e.currentTheme);const s=this.formElement.querySelector('[data-key="select-theme"]');s&&(s.textContent=e.currentThemeKey?"–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É":"–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É",s.classList.toggle("theme-button--selected",!!e.currentThemeKey));const r=this.formElement.querySelector('[data-key="post-content"]'),i=this.formElement.querySelector('[data-key="post-title"]');r&&(r.value=e.draftContent),i&&(i.value=e.draftTitle);const o=this.formElement.querySelector(".char-counter__number");o&&(o.textContent=(this.maxChars-e.draftContent.length).toString())}showError(e){if(!this.formElement)return;const t=this.formElement.querySelector(".create-post-form__error");t&&t.remove();const n=document.createElement("div");n.className="create-post-form__error",n.textContent=e;const s=this.formElement.querySelector('[data-key="create-post-form"]');s?.parentNode&&s.parentNode.insertBefore(n,s)}async render(){const e=await async function(){if(A)return A;await Promise.all([{name:"input",path:"/components/Input/Input.hbs"},{name:"form-button",path:"/components/FormButton/FormButton.hbs"},{name:"icon",path:"/components/Icon/Icon.hbs"},{name:"user-menu",path:"/components/UserMenu/UserMenu.hbs"},{name:"menu-item",path:"/components/MenuItem/MenuItem.hbs"}].map(async e=>{if(!Handlebars.partials[e.name]){const t=await fetch(e.path),n=await t.text();Handlebars.registerPartial(e.name,Handlebars.compile(n))}}));const e=await fetch("/components/CreatePostForm/CreatePostForm.hbs"),t=await e.text();return A=Handlebars.compile(t),A}(),t=l.getState(),n=S.getState(),s=e({name:t.user?.name||"–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",subtitle:n.currentTheme,avatar:t.user?.avatar||"/img/defaultAvatar.jpg"}),r=document.createElement("div");return r.innerHTML=s.trim(),this.formElement=r.firstElementChild,this.formElement.classList.add("create-post-form--modal"),this.setupEventHandlers(),this.updateUIFromState(n),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector('[data-key="overlay"]');e?.addEventListener("click",t=>{t.target===e&&this.close()});const t=this.formElement.querySelector('[data-key="create-post-form"]');t?.addEventListener("submit",e=>{e.preventDefault();const n=S.getState(),s=new FormData(t),r={title:s.get("title"),content:s.get("content"),theme:n.currentThemeKey};n.isEditing&&n.editingPostId?((e,t)=>{i.dispatch("EDIT_POST_REQUEST",{postId:e,...t})})(n.editingPostId,r):(e=>{i.dispatch("CREATE_POST_REQUEST",e)})(r)});const n=this.formElement.querySelector('[data-key="post-content"]');n?.addEventListener("input",e=>{var t;t=e.target.value,i.dispatch("POST_CONTENT_CHANGED",{content:t})});const s=this.formElement.querySelector('[data-key="post-title"]');s?.addEventListener("input",e=>{i.dispatch("POST_TITLE_CHANGED",{title:e.target.value})});const r=this.formElement.querySelector('[data-key="select-theme"]');r?.addEventListener("click",async()=>{const e=new L(e=>{const t=_.find(t=>t.key===e);t&&((e,t)=>{i.dispatch("THEME_SELECTED",{theme:e,key:t})})(t.text,e)});await e.render()})}close(){this.formElement?.parentNode&&(this.formElement.remove(),this.formElement=null),i.dispatch("CREATE_POST_FORM_INIT"),this.destroy()}destroy(){S.removeListener(this.boundStoreHandler)}}let v=null,T=!1,b=null;class I{constructor(){this.headerElement=null,this.container=null,this.boundStoreHandler=this.handleStoreChange.bind(this),this.init()}init(){l.addListener(this.boundStoreHandler),i.dispatch("LOGIN_CHECK_REQUEST")}async render(e){e&&(this.container=e);const t=await async function(){return v||b||(T=!0,b=(async()=>{try{const[e,t,n,s]=await Promise.all([fetch("/components/Input/Input.hbs"),fetch("/components/FormButton/FormButton.hbs"),fetch("/components/Icon/Icon.hbs"),fetch("/components/Header/Header.hbs")]);if(!Handlebars.partials.input){const t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t))}if(!Handlebars.partials.button){const e=await t.text();Handlebars.registerPartial("button",Handlebars.compile(e))}if(!Handlebars.partials.icon){const e=await n.text();Handlebars.registerPartial("icon",Handlebars.compile(e))}const r=await s.text();return v=Handlebars.compile(r),v}catch(e){throw b=null,T=!1,e}})(),b)}(),n=l.getState(),s=t({isLoggedIn:n.isLoggedIn,user:n.user}),r=document.createElement("div");if(r.innerHTML=s.trim(),this.headerElement&&this.headerElement.parentNode&&this.headerElement.remove(),this.headerElement=r.firstElementChild,!this.headerElement)throw new Error("Header element not found");return this.setupEventHandlers(),this.headerElement}setupEventHandlers(){if(!this.headerElement)return;const e=l.getState(),t=this.headerElement.querySelector('[data-key="logo"]');t&&t.addEventListener("click",e=>{e.preventDefault(),this.navigateToHome()});const n=this.headerElement.querySelector('[data-key="user-menu"]');n&&e.isLoggedIn&&e.user&&n.addEventListener("click",async t=>{t.stopPropagation();const s=document.querySelector(".popUp-menu");if(s)return void s.remove();const r=new a({user:e.user,menuItems:[{key:"bookmarks",icon:"/img/icons/note_icon.svg",text:"–ß–µ—Ä–Ω–æ–≤–∏–∫–∏"},{key:"saved",icon:"/img/icons/bookmark.svg",text:"–ó–∞–∫–ª–∞–¥–∫–∏"},{key:"settings",icon:"/img/icons/settings_icon.svg",text:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"subscription",icon:"/img/icons/premium_icon.svg",text:"–ü–æ–¥–ø–∏—Å–∫–∞"},{key:"logout",icon:"/img/icons/exit_icon.svg",text:"–í—ã–π—Ç–∏"}]}),i=await r.render(),o=n.getBoundingClientRect();i.style.position="absolute",i.style.top=`${o.bottom+10}px`,i.style.right=window.innerWidth-o.right+"px",i.style.zIndex="1000",document.body.appendChild(i);const c=e=>{const t=e.target;i.contains(t)||t===n||(i.remove(),document.removeEventListener("click",c))};document.addEventListener("click",c)});const s=this.headerElement.querySelector('button[data-key="createPost"]');s&&(e.isLoggedIn?s.addEventListener("click",async e=>{e.preventDefault();const t=new y,n=await t.render();document.body.appendChild(n)}):s.addEventListener("click",async e=>{e.preventDefault(),await this.showLoginForm()}));const r=this.headerElement.querySelector('button[data-key="login"]');r&&!e.isLoggedIn&&r.addEventListener("click",async e=>{e.preventDefault(),await this.showLoginForm()})}navigateToHome(){e.navigate("/")}async showLoginForm(){const e=new E,t=await e.render();document.body.appendChild(t)}async handleStoreChange(){if(this.container&&this.headerElement){const e=await this.render();this.container.appendChild(e)}}destroy(){l.removeListener(this.boundStoreHandler),this.headerElement&&this.headerElement.parentNode&&this.headerElement.remove()}}let P=null;const O=[{name:"–ê–∫–∫–∞—É–Ω—Ç 1",subtitle:"250,4k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 2",subtitle:"245,2k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 3",subtitle:"240,1k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 4",subtitle:"235,7k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 5",subtitle:"230,3k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 6",subtitle:"225,8k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"},{name:"–ê–∫–∫–∞—É–Ω—Ç 7",subtitle:"220,5k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤",avatar:"/img/defaultAvatar.jpg"}];class U{constructor({bloggers:e=O}={}){this.bloggers=e}async render(){const e=(await async function(){if(P)return P;const e=await fetch("/components/UserMenu/UserMenu.hbs"),t=await e.text();Handlebars.registerPartial("user-menu",Handlebars.compile(t));const n=await fetch("/components/TopBloggers/TopBloggers.hbs"),s=await n.text();return P=Handlebars.compile(s),P}())({bloggers:this.bloggers.slice(0,7)}),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Top bloggers element not found");return n}}class k{constructor(e,t){this.isOpen=!1,this.handleClickOutside=e=>{const t=e.target;this.element.contains(t)||this.menuButton.contains(t)||this.close()},this.menuButton=e,this.element=t,this.init()}init(){this.menuButton.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggle()}),this.element.querySelectorAll("[data-key]").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault()})})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(document.querySelectorAll(".post-card-menu").forEach(e=>{e!==this.element&&e.classList.remove("post-card-menu--open")}),this.element.classList.add("post-card-menu--open"),this.isOpen=!0,setTimeout(()=>{document.addEventListener("click",this.handleClickOutside)},10))}close(){this.isOpen&&(this.element.classList.remove("post-card-menu--open"),this.isOpen=!1,document.removeEventListener("click",this.handleClickOutside))}}let D=null;class R{constructor(e){this.postId=e.postId;const{user:t={name:"–ê–∫–∫–∞—É–Ω—Ç",subtitle:"—Ç–µ–º–∞",avatar:null,isSubscribed:!1},title:n="–ë–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞",text:s="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –ø–æ–º–µ–Ω—å—à–µ",link:r="",linkText:i="—Å—Å—ã–ª–∫–∞",tags:o=["—Ç–µ–≥1","—Ç–µ–≥2","—Ç–µ–≥3"],commentsCount:a=123,repostsCount:c=42,viewsCount:l=42,isOwnPost:d=!1}=e;this.user=t,this.title=n,this.text=s,this.link=r,this.linkText=i,this.tags=o,this.commentsCount=a,this.repostsCount=c,this.viewsCount=l,this.menuId=`post-card-menu-${Date.now()}-${Math.floor(1e3*Math.random())}`,this.isOwnPost=d,this.onMenuAction=e.onMenuAction}async render(){const e=this.text.length>200?this.text.substring(0,200):null;let t=[{key:"hide",text:"–°–∫—Ä—ã—Ç—å"},{key:"report",text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è"}];this.isOwnPost&&(t=[{key:"edit",text:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"},{key:"delete",text:"–£–¥–∞–ª–∏—Ç—å"},...t]);const n=(await async function(){if(D)return D;await Promise.all([{name:"user-menu",path:"/components/UserMenu/UserMenu.hbs"},{name:"tag",path:"/components/Tag/Tag.hbs"},{name:"icon",path:"/components/Icon/Icon.hbs"},{name:"menu-item",path:"/components/MenuItem/MenuItem.hbs"},{name:"post-card-menu",path:"/components/PostCardMenu/PostCardMenu.hbs"}].map(async e=>{if(!Handlebars.partials[e.name]){const t=await fetch(e.path),n=await t.text();Handlebars.registerPartial(e.name,Handlebars.compile(n))}}));const e=await fetch("/components/PostCard/PostCard.hbs"),t=await e.text();return D=Handlebars.compile(t),D}())({user:this.user,title:this.title,titleTruncated:null,text:this.text,textTruncated:e,link:this.link,linkText:this.linkText,tags:this.tags,commentsCount:this.commentsCount,repostsCount:this.repostsCount,viewsCount:this.viewsCount,menuId:this.menuId,menuItems:t}),s=document.createElement("div");s.innerHTML=n.trim();const r=s.firstElementChild;if(!r)throw new Error("Post card element not found");this.setupAuthorClickHandlers(r);const o=r.querySelector('[data-key="toggle-text"]'),a=r.querySelector(".post-card__text-preview"),c=r.querySelector(".post-card__text-full");if(o&&a&&c){let e=!1;o.addEventListener("click",t=>{t.preventDefault(),e=!e,a.hidden=e,c.hidden=!e,o.textContent=e?"–°–∫—Ä—ã—Ç—å":"–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é"})}const l=r.querySelector(".post-card__title");l&&(l.style.cursor="pointer",l.title="–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å—Ç",l.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=`/post/${this.postId}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))}));const d=r.querySelector(".post-card__menu-button"),h=r.querySelector(".post-card-menu");return d&&h&&new k(d,h),r.querySelectorAll(".post-card-menu [data-key]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-key");n&&("edit"===n?i.dispatch("POST_EDIT_REQUEST",{postId:this.postId}):this.onMenuAction?.(n))})}),r}setupAuthorClickHandlers(e){const t=e.querySelector(".user-menu__avatar"),n=e.querySelector(".user-menu__name"),s=e.querySelector(".user-menu__subtitle"),r=e.querySelector(".user-menu__button"),i=e=>{e.preventDefault(),e.stopPropagation(),console.log(`[PostCard] –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∞: ${this.user.name}`,this.user.id);let t="/profile";this.user.id&&(t+=`?id=${this.user.id}`),window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))};t&&(t.style.cursor="pointer",t.addEventListener("click",i)),n&&(n.style.cursor="pointer",n.addEventListener("click",i)),s&&(s.style.cursor="pointer",s.addEventListener("click",i));const o=e.querySelector(".user-menu");o&&(o.style.cursor="pointer",o.addEventListener("click",e=>{r&&r.contains(e.target)||i(e)})),r&&r.addEventListener("click",e=>{e.stopPropagation()})}}const N=new class extends c{constructor(){super({posts:[],isLoading:!1,error:null,hasMore:!0,currentFilter:"fresh"})}registerActions(){this.registerAction("POSTS_LOAD_START",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("POSTS_LOAD_SUCCESS",e=>{this.setState({posts:[...this.state.posts,...e.posts],isLoading:!1,hasMore:e.posts.length>0})}),this.registerAction("POSTS_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("POSTS_CLEAR",()=>{this.setState({posts:[],error:null})}),this.registerAction("POSTS_SET_FILTER",e=>{this.setState({posts:[],currentFilter:e.filter,hasMore:!0,error:null,isLoading:!1}),i.dispatch("POSTS_LOAD_REQUEST",{filter:e.filter})}),this.registerAction("POSTS_RELOAD_AFTER_CREATE",()=>{i.dispatch("POSTS_LOAD_REQUEST",{filter:this.state.currentFilter})}),this.registerAction("POSTS_RELOAD_AFTER_DELETE",()=>{i.dispatch("POSTS_LOAD_REQUEST",{filter:this.state.currentFilter})})}};class F{constructor(){this.feedWrapper=null,this.sentinel=null,this.observer=null,this.virtualPostIndex=0,this.allPosts=[],this.currentFilter="fresh",this.boundStoreHandler=this.handleStoreChange.bind(this),this.handlePostAction=this.handlePostAction.bind(this),this.initStoreListener()}initStoreListener(){N.addListener(this.boundStoreHandler)}async init(e){if(this.feedWrapper=e||document.getElementById("feed-wrapper"),!this.feedWrapper)throw new Error("Feed wrapper not found");this.setupInfiniteScroll()}setupInfiniteScroll(){this.feedWrapper&&(this.sentinel=document.createElement("div"),this.sentinel.style.height="20px",this.sentinel.className="scroll-sentinel",this.feedWrapper.appendChild(this.sentinel),this.observer=new IntersectionObserver(e=>{e[0].isIntersecting&&this.allPosts.length>0&&this.renderNextPosts()},{rootMargin:"100px"}),this.sentinel&&this.observer.observe(this.sentinel))}handleStoreChange(){const e=N.getState();this.currentFilter!==e.currentFilter&&(this.currentFilter=e.currentFilter,this.virtualPostIndex=0,this.feedWrapper&&(this.feedWrapper.innerHTML="",this.sentinel&&this.feedWrapper.appendChild(this.sentinel))),e.posts.length>0&&(this.allPosts=[...e.posts],this.renderNextPosts()),e.error&&this.showError(e.error)}transformPost(e){const t=l.getState(),n=t.user?.id,s=!!n&&n===e.authorId;return{postId:e.id||"",authorId:e.authorId,user:{name:e.authorName||"–ê–Ω–æ–Ω–∏–º",subtitle:e.theme||"–ë–ª–æ–≥",avatar:e.authorAvatar||"/img/defaultAvatar.jpg",isSubscribed:!1,id:e.authorId},title:e.title||"",text:e.content||"",tags:Array.isArray(e.tags)?e.tags:[],commentsCount:e.commentsCount||0,repostsCount:e.repostsCount||0,viewsCount:e.viewsCount||0,isOwnPost:s}}async renderNextPosts(){if(!this.feedWrapper||0===this.allPosts.length)return;const e=document.createDocumentFragment();for(let t=0;t<3;t++){this.virtualPostIndex>=this.allPosts.length&&(this.virtualPostIndex=0);const t=this.allPosts[this.virtualPostIndex],n=this.transformPost(t);try{const s=new R({...n,onMenuAction:e=>this.handlePostAction(e,t.id)}),r=await s.render();e.appendChild(r)}catch(e){console.error("Error rendering post:",e)}this.virtualPostIndex++}this.sentinel?this.feedWrapper.insertBefore(e,this.sentinel):this.feedWrapper.appendChild(e)}showError(e){if(!this.feedWrapper)return;this.feedWrapper.innerHTML="";const t=document.createElement("div");t.className="feed-error",t.textContent=e,this.feedWrapper.appendChild(t)}destroy(){N.removeListener(this.boundStoreHandler),this.observer&&this.sentinel&&this.observer.unobserve(this.sentinel),this.feedWrapper=null,this.sentinel=null}handlePostAction(e,t){if(t)switch(e){case"edit":i.dispatch("POST_EDIT_REQUEST",{postId:t});break;case"delete":confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?")&&i.dispatch("POST_DELETE_REQUEST",{postId:t});break;case"hide":i.dispatch("POST_HIDE_REQUEST",{postId:t});break;case"report":i.dispatch("POST_REPORT_REQUEST",{postId:t})}}}class H{constructor(){this.feedWrapper=null,this.headerInstance=new I,this.postsView=new F}async render(){const e=new URL(window.location.href);let t="fresh";const n=e.searchParams.get("filter");n?t=n:"/feed"===e.pathname&&(t="fresh"),i.dispatch("POSTS_SET_FILTER",{filter:t});const s=document.createElement("div"),r=document.createElement("header"),o=await this.headerInstance.render(r);r.appendChild(o),s.appendChild(r);const a=document.createElement("div");a.className="content-layout",s.appendChild(a);const c=document.createElement("aside");c.className="sidebar-left";let l=null,d=null;const h=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},u=new C(w,t,e=>{d&&h(d);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});l=await u.render();const p=new C(_,t,e=>{l&&h(d);const t=""===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});d=await p.render(),c.appendChild(l),c.appendChild(d);const m=document.createElement("main");m.className="main-content",this.feedWrapper=document.createElement("div"),this.feedWrapper.className="feed",this.feedWrapper.id="feed-wrapper",m.appendChild(this.feedWrapper);const g=document.createElement("aside");g.className="sidebar-right";const E=new U,S=await E.render();g.appendChild(S),a.appendChild(c),a.appendChild(m),a.appendChild(g);try{await this.postsView.init(this.feedWrapper),console.log("PostsView initialized successfully")}catch(e){console.error("Failed to initialize PostsView:",e);const t=document.createElement("div");t.className="feed-error",t.textContent="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–µ–Ω—Ç—É –ø–æ—Å—Ç–æ–≤",this.feedWrapper&&this.feedWrapper.appendChild(t)}return s}destroy(){this.headerInstance.destroy(),this.postsView.destroy()}}let x=null;class M{constructor(e){this.props=e}async render(){const e=(await async function(){if(x)return x;const e=await fetch("/components/PostCard/PostCard.hbs");if(e.ok){const t=await e.text();Handlebars.registerPartial("post-card",Handlebars.compile(t))}Handlebars.registerHelper("eq",(e,t)=>e===t);const t=await fetch("/components/Profile/Profile.hbs"),n=await t.text();return x=Handlebars.compile(n),x}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Profile element not found");return n}}const q=new class extends c{constructor(){super({profile:null,posts:[],comments:[],activeTab:"posts",isLoading:!1,error:null})}registerActions(){this.registerAction("PROFILE_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("PROFILE_LOAD_SUCCESS",e=>{this.setState({profile:e.profile,posts:e.posts,isLoading:!1,error:null})}),this.registerAction("PROFILE_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("PROFILE_CHANGE_TAB",e=>{this.setState({activeTab:e.tab})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_SUCCESS",e=>{this.state.profile&&this.setState({profile:{...this.state.profile,description:e.description},isLoading:!1,error:null})}),this.registerAction("PROFILE_UPDATE_DESCRIPTION_FAIL",e=>{this.setState({isLoading:!1,error:e.error})})}};class W{constructor(e,t){if(this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new I,t&&t.id)this.userId=parseInt(t.id);else{const e=new URLSearchParams(window.location.search).get("id");e&&(this.userId=parseInt(e))}this.boundStoreHandler=this.handleStoreChange.bind(this),this.boundLoginStoreHandler=this.handleLoginStoreChange.bind(this)}async render(){return q.addListener(this.boundStoreHandler),l.addListener(this.boundLoginStoreHandler),i.dispatch("PROFILE_LOAD_REQUEST",{userId:this.userId}),await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const n=document.createElement("div");n.className="content-layout";const s=document.createElement("aside");s.className="sidebar-left";let r=null,o=null;const a=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},c=new C(w,"fresh",e=>{o&&a(o),i.dispatch("POSTS_SET_FILTER",{filter:e})});r=await c.render();const l=new C(_,"",e=>{r&&a(r),i.dispatch("POSTS_SET_FILTER",{filter:e})});o=await l.render(),s.appendChild(r),s.appendChild(o);const d=document.createElement("main");d.className="main-content";const h=await this.renderProfileContent();d.appendChild(h);const u=document.createElement("aside");u.className="sidebar-right",this.topBloggers=new U;const p=await this.topBloggers.render();u.appendChild(p),n.appendChild(s),n.appendChild(d),n.appendChild(u),this.pageWrapper.appendChild(n),this.container.appendChild(this.pageWrapper)}async renderProfileContent(){const e=q.getState(),t=new M({profile:e.profile,posts:e.posts,activeTab:e.activeTab,isLoading:e.isLoading,error:e.error}),n=await t.render();return this.attachEventListeners(n),n}handleStoreChange(){const e=this.container.querySelector(".main-content");e&&this.renderProfileContent().then(t=>{e.innerHTML="",e.appendChild(t)})}handleLoginStoreChange(){l.getState().isLoggedIn||e.navigate("/")}attachEventListeners(e){e.querySelectorAll("[data-tab]").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.tab;"posts"!==t&&"comments"!==t||i.dispatch("PROFILE_CHANGE_TAB",{tab:t})})});const t=e.querySelector(".profile__edit-btn");t&&t.addEventListener("click",()=>{this.editDescription()});const n=e.querySelector(".profile__description-placeholder");n&&n.addEventListener("click",()=>{this.editDescription()})}editDescription(){const e=q.getState();if(!e.profile)return;const t=prompt("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:",e.profile.description||"");null!==t&&i.dispatch("PROFILE_UPDATE_DESCRIPTION_REQUEST",{description:t})}destroy(){q.removeListener(this.boundStoreHandler),l.removeListener(this.boundLoginStoreHandler),this.headerInstance.destroy()}}let G=null;class B{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(G)return G;const e=await fetch("/components/Settings/Settings.hbs"),t=await e.text();return G=Handlebars.compile(t),G}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Settings element not found");return n}}class ${constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new I}async render(){return await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const n=document.createElement("div");n.className="content-layout";const s=document.createElement("aside");s.className="sidebar-left";let r=null,i=null;const o=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},a=new C(w,"fresh",e=>{i&&o(i);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await a.render();const c=new C(_,"",e=>{i&&o(i);const t=""===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render(),s.appendChild(r),s.appendChild(i);const l=document.createElement("main");l.className="main-content";const d=await this.renderSettingsMain();l.appendChild(d);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggers=new U;const u=await this.topBloggers.render();h.appendChild(u),n.appendChild(s),n.appendChild(l),n.appendChild(h),this.pageWrapper.appendChild(n),this.container.appendChild(this.pageWrapper)}async renderSettingsMain(){const e=new B({}),t=await e.render();return this.attachEventListeners(t),t}attachEventListeners(t){t.querySelectorAll(".settings-main__nav-item").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.route;n&&e.navigate(n)})})}destroy(){this.headerInstance.destroy()}}let Q=null;class V{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(Q)return Q;const e=await fetch("/components/SettingsAccount/SettingsAccount.hbs"),t=await e.text();return Q=Handlebars.compile(t),Q}())(this.formatUserData(this.props.userData)),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("SettingsAccount element not found");return this.attachEditButtonListener(n),this.attachDeleteButtonListener(n),n}formatUserData(e){if(!e)return{name:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",phone:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",email:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",created_at:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",country:"–†–æ—Å—Å–∏—è",language:"–†—É—Å—Å–∫–∏–π",sex:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",date_of_birth:"–ù–µ —É–∫–∞–∑–∞–Ω–æ",age:"–ù–µ —É–∫–∞–∑–∞–Ω–æ"};let t="–ù–µ —É–∫–∞–∑–∞–Ω–æ";if(e.created_at){const n=new Date(e.created_at);t=n.toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"})+", "+n.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}let n="–ù–µ —É–∫–∞–∑–∞–Ω–æ",s="–ù–µ —É–∫–∞–∑–∞–Ω–æ";if(e.date_of_birth){const t=new Date(e.date_of_birth);n=t.toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"});const r=new Date;let i=r.getFullYear()-t.getFullYear();const o=r.getMonth()-t.getMonth();(o<0||0===o&&r.getDate()<t.getDate())&&i--,s=i.toString()}let r=e.sex;return"male"===e.sex&&(r="–ú—É–∂—Å–∫–æ–π"),"female"===e.sex&&(r="–ñ–µ–Ω—Å–∫–∏–π"),"other"===e.sex&&(r="–î—Ä—É–≥–æ–π"),{name:e.name||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",phone:e.phone||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",email:e.email||"–ù–µ —É–∫–∞–∑–∞–Ω–æ",created_at:t,country:e.country||"–†–æ—Å—Å–∏—è",language:e.language||"–†—É—Å—Å–∫–∏–π",sex:r,date_of_birth:n,age:s}}attachEditButtonListener(e){const t=e.querySelector(".settings-account__edit-button");t&&t.addEventListener("click",()=>{const t=new CustomEvent("editAccountRequest");e.dispatchEvent(t)})}attachDeleteButtonListener(e){const t=e.querySelector(".settings-account__delete-button");t&&t.addEventListener("click",()=>{const t=new CustomEvent("deleteAccountRequest");e.dispatchEvent(t)})}}const j=new class extends c{constructor(){super({settings:null,isLoading:!1,error:null,isUpdating:!1})}registerActions(){this.registerAction("SETTINGS_ACCOUNT_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("SETTINGS_ACCOUNT_LOAD_SUCCESS",e=>{const t={...e.settings,age:this.calculateAge(e.settings.date_of_birth)};this.setState({settings:t,isLoading:!1,error:null})}),this.registerAction("SETTINGS_ACCOUNT_LOAD_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_REQUEST",()=>{this.setState({isUpdating:!0,error:null})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_SUCCESS",e=>{const t={...e.settings,age:this.calculateAge(e.settings.date_of_birth)};this.setState({settings:t,isUpdating:!1,error:null})}),this.registerAction("SETTINGS_ACCOUNT_UPDATE_FAIL",e=>{this.setState({isUpdating:!1,error:e.error})})}calculateAge(e){if(!e)return;const t=new Date(e),n=new Date;let s=n.getFullYear()-t.getFullYear();const r=n.getMonth()-t.getMonth();return(r<0||0===r&&n.getDate()<t.getDate())&&s--,s}},K=new class extends c{constructor(){super({isOpen:!1,isLoading:!1,error:null,formData:{}})}registerActions(){this.registerAction("EDIT_PROFILE_OPEN",e=>{console.log("EDIT_PROFILE_OPEN - Received initial data:",e.initialData),this.setState({isOpen:!0,formData:{...e.initialData,password:""},error:null}),console.log("EDIT_PROFILE_OPEN - Updated formData:",this.state.formData)}),this.registerAction("EDIT_PROFILE_CLOSE",()=>{this.setState({isOpen:!1,formData:{},error:null,isLoading:!1})}),this.registerAction("EDIT_PROFILE_UPDATE_REQUEST",()=>{this.setState({isLoading:!0,error:null})}),this.registerAction("EDIT_PROFILE_UPDATE_SUCCESS",()=>{this.setState({isOpen:!1,isLoading:!1,formData:{},error:null})}),this.registerAction("EDIT_PROFILE_UPDATE_FAIL",e=>{this.setState({isLoading:!1,error:e.error})}),this.registerAction("SETTINGS_ACCOUNT_LOAD_SUCCESS",e=>{if(console.log("SETTINGS_ACCOUNT_LOAD_SUCCESS - Received settings:",e.settings),this.state.isOpen){const t=this.state.formData.password||"";this.setState({formData:{...e.settings,password:t}}),console.log("SETTINGS_ACCOUNT_LOAD_SUCCESS - Updated formData:",this.state.formData)}})}};let z=null;class J{constructor(e){this.props=e}async render(){const e=(await async function(){if(z)return z;const e=await fetch("/components/Input/Input.hbs"),t=await e.text();Handlebars.registerPartial("input",Handlebars.compile(t));const n=await fetch("/components/FormButton/FormButton.hbs"),s=await n.text();Handlebars.registerPartial("button",Handlebars.compile(s));const r=await fetch("/components/ProfileEdit/ProfileEdit.hbs"),i=await r.text();return Handlebars.registerHelper("eq",function(e,t){return e===t}),z=Handlebars.compile(i),z}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("Edit profile form element not found");return n}}class Z{constructor(){this.formElement=null,this.boundStoreHandler=this.handleStoreChange.bind(this),this.boundAccountStoreHandler=this.handleAccountStoreChange.bind(this),this.init()}init(){K.addListener(this.boundStoreHandler),j.addListener(this.boundAccountStoreHandler)}async render(){const e=K.getState();console.log("Rendering edit profile with data:",e.formData);const t=new J({settings:e.formData,isLoading:e.isLoading,error:e.error});return this.formElement=await t.render(),this.setupEventHandlers(),this.formElement}setupEventHandlers(){if(!this.formElement)return;const e=this.formElement.querySelector(".edit-profile-form");e&&e.addEventListener("submit",this.handleSubmit.bind(this));const t=this.formElement.querySelector('button[type="button"]');t&&t.addEventListener("click",this.handleCancel.bind(this)),this.formElement.addEventListener("click",e=>{e.target===this.formElement&&this.handleCancel()})}async handleSubmit(e){if(e.preventDefault(),!this.formElement)return;const t=this.formElement.querySelector(".edit-profile-form"),n=new FormData(t),s=K.getState().formData.email,r={},o=n.get("name")?.trim();o&&(r.name=o),s&&(r.email=s);const a=n.get("password")?.trim();a&&(r.password=a);const c=n.get("phone")?.trim(),l=n.get("country")?.trim(),d=n.get("language"),h=n.get("sex"),u=n.get("date_of_birth");void 0!==c&&(r.phone=c||""),void 0!==l&&(r.country=l||""),void 0!==d&&(r.language=d),void 0!==h&&(r.sex=h),void 0!==u&&(r.date_of_birth=u||""),console.log("Updating profile with:",r);const p=this.validateForm(r);p.length>0?this.showFieldErrors(t,p):i.dispatch("EDIT_PROFILE_UPDATE_REQUEST",{settings:r})}validateForm(e){const t=[];return e.name&&0!==e.name.trim().length||t.push({field:"name",message:"–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"}),e.password&&e.password.length<4&&t.push({field:"password",message:"–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤"}),e.phone&&!/^\+?[\d\s\-()]+$/.test(e.phone)&&t.push({field:"phone",message:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞"}),e.date_of_birth&&new Date(e.date_of_birth)>new Date&&t.push({field:"date_of_birth",message:"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º"}),t}handleCancel(){i.dispatch("EDIT_PROFILE_CLOSE")}handleStoreChange(){const e=K.getState();if(!e.isOpen&&this.formElement&&this.formElement.parentNode&&this.formElement.remove(),e.error&&this.formElement){const t=this.formElement.querySelector(".edit-profile-form");this.showGlobalError(t,e.error)}}handleAccountStoreChange(){const e=j.getState();K.getState().isOpen&&e.settings&&!e.isUpdating&&i.dispatch("EDIT_PROFILE_CLOSE")}showFieldErrors(e,t){this.clearErrors(e),t.forEach(({field:t,message:n})=>{const s=e.querySelector(`[name="${t}"]`);if(!s)return;s.classList.add("error");const r=document.createElement("div");r.className="field-error",r.textContent=n;const i=s.closest(".form-group");i&&i.appendChild(r)})}showGlobalError(e,t){this.clearErrors(e);const n=document.createElement("div");n.className="global-error",n.textContent=t,e.appendChild(n)}clearErrors(e){e.querySelectorAll(".form__input").forEach(e=>{e.classList.remove("error")}),e.querySelectorAll(".field-error, .global-error").forEach(e=>e.remove())}destroy(){K.removeListener(this.boundStoreHandler),j.removeListener(this.boundAccountStoreHandler),this.formElement&&this.formElement.parentNode&&this.formElement.remove()}}let X=null;class Y{constructor(e={}){this.element=null,this.props=e}async render(){const e=(await async function(){if(X)return X;const e=await fetch("/components/DeleteAccount/DeleteAccount.hbs"),t=await e.text();return X=Handlebars.compile(t),X}())(this.props),t=document.createElement("div");if(t.innerHTML=e.trim(),this.element=t.firstElementChild,!this.element)throw new Error("DeleteAccountModal element not found");return this.setupEventListeners(),this.element}setupEventListeners(){if(!this.element)return;this.element.addEventListener("click",e=>{e.target===this.element&&this.close()});const e=this.element.querySelector(".delete-account-modal__cancel");e&&e.addEventListener("click",()=>{this.close()});const t=this.element.querySelector(".delete-account-modal__delete");t&&t.addEventListener("click",()=>{this.handleDelete()})}close(){this.element&&this.element.parentNode&&this.element.remove()}handleDelete(){const e=this.element?.querySelector(".delete-account-modal__delete");e&&(e.disabled=!0,e.textContent="–£–¥–∞–ª–µ–Ω–∏–µ...");const t=new CustomEvent("accountDeleteRequest");this.element?.dispatchEvent(t)}destroy(){this.element&&this.element.parentNode&&this.element.remove()}}class ee{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.editProfileView=null,this.deleteModal=null,this.container=e,this.headerInstance=new I,this.boundStoreHandler=this.handleStoreChange.bind(this),this.boundEditStoreHandler=this.handleEditStoreChange.bind(this),this.boundLoginStoreHandler=this.handleLoginStoreChange.bind(this)}async render(){return j.addListener(this.boundStoreHandler),K.addListener(this.boundEditStoreHandler),l.addListener(this.boundLoginStoreHandler),i.dispatch("SETTINGS_ACCOUNT_LOAD_REQUEST"),await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const n=document.createElement("div");n.className="content-layout";const s=document.createElement("aside");s.className="sidebar-left";let r=null,i=null;const o=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},a=new C(w,"fresh",e=>{i&&o(i);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await a.render();const c=new C(_,"",e=>{r&&o(i);const t=""===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render(),s.appendChild(r),s.appendChild(i);const l=document.createElement("main");l.className="main-content";const d=await this.renderAccountContent();l.appendChild(d);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggers=new U;const u=await this.topBloggers.render();h.appendChild(u),n.appendChild(s),n.appendChild(l),n.appendChild(h),this.pageWrapper.appendChild(n),this.container.appendChild(this.pageWrapper),this.checkEditForm()}async renderAccountContent(){const e=j.getState();console.log("Current account state:",e);const t=new V({userData:e.settings}),n=await t.render();return this.attachEditButtonListener(n),this.attachDeleteButtonListener(n),n}attachEditButtonListener(e){e.addEventListener("editAccountRequest",()=>{this.handleEditButtonClick()})}attachDeleteButtonListener(e){e.addEventListener("deleteAccountRequest",()=>{this.openDeleteModal()})}handleLoginStoreChange(){l.getState().isLoggedIn||(l.removeListener(this.boundLoginStoreHandler),e.navigate("/"))}handleEditButtonClick(){const e=j.getState();if(console.log("Edit button clicked, account state:",e),e.settings){const t={name:e.settings.name||"",phone:e.settings.phone||"",email:e.settings.email||"",country:e.settings.country||"",language:e.settings.language||"–†—É—Å—Å–∫–∏–π",sex:e.settings.sex||"other",date_of_birth:e.settings.date_of_birth||""};console.log("Dispatching EDIT_PROFILE_OPEN with data:",t),i.dispatch("EDIT_PROFILE_OPEN",{initialData:t})}else console.error("No settings data available when opening edit form")}async openDeleteModal(){if(this.deleteModal)return;this.deleteModal=new Y;const e=await this.deleteModal.render();e.addEventListener("accountDeleteRequest",()=>{this.handleAccountDelete()}),this.pageWrapper?.appendChild(e)}handleAccountDelete(){i.dispatch("ACCOUNT_DELETE_REQUEST"),this.closeDeleteModal()}closeDeleteModal(){this.deleteModal&&(this.deleteModal.destroy(),this.deleteModal=null)}async checkEditForm(){const e=K.getState();if(console.log("Checking edit form, editState:",e),e.isOpen&&!this.editProfileView){console.log("Creating EditProfileView with formData:",e.formData),this.editProfileView=new Z;const t=await this.editProfileView.render();this.pageWrapper?.appendChild(t)}}handleStoreChange(){const e=j.getState();console.log("Settings account store changed:",e),e.error&&console.error("Settings account error:",e.error),e.settings&&!e.isLoading&&this.updateAccountContent()}handleEditStoreChange(){const e=K.getState();console.log("Edit profile store changed:",e),e.isOpen?this.checkEditForm():this.editProfileView&&(this.editProfileView.destroy(),this.editProfileView=null)}async updateAccountContent(){if(!this.pageWrapper)return;const e=this.pageWrapper.querySelector(".main-content");if(e){const t=e.querySelector(".settings-account");t&&t.remove();const n=await this.renderAccountContent();e.appendChild(n)}}destroy(){j.removeListener(this.boundStoreHandler),K.removeListener(this.boundEditStoreHandler),this.editProfileView&&this.editProfileView.destroy(),this.deleteModal&&this.deleteModal.destroy(),this.headerInstance.destroy()}}let te=null;class ne{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(te)return te;const e=await fetch("/components/SettingsNotifications/SettingsNotifications.hbs"),t=await e.text();return te=Handlebars.compile(t),te}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("SettingsNotifications element not found");return n}}class se{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new I}async render(){return await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const n=document.createElement("div");n.className="content-layout";const s=document.createElement("aside");s.className="sidebar-left";let r=null,i=null;const o=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},a=new C(w,"fresh",e=>{i&&o(i);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await a.render();const c=new C(_,"",e=>{r&&o(i);const t=""===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await c.render(),s.appendChild(r),s.appendChild(i);const l=document.createElement("main");l.className="main-content";const d=await this.renderNotificationsContent();l.appendChild(d);const h=document.createElement("aside");h.className="sidebar-right",this.topBloggers=new U;const u=await this.topBloggers.render();h.appendChild(u),n.appendChild(s),n.appendChild(l),n.appendChild(h),this.pageWrapper.appendChild(n),this.container.appendChild(this.pageWrapper)}async renderNotificationsContent(){const e=new ne({});return await e.render()}destroy(){this.headerInstance.destroy()}}let re=null;class ie{constructor(e={}){this.props=e}async render(){const e=(await async function(){if(re)return re;const e=await fetch("/components/SettingsPrivacy/SettingsPrivacy.hbs"),t=await e.text();return re=Handlebars.compile(t),re}())(this.props),t=document.createElement("div");t.innerHTML=e.trim();const n=t.firstElementChild;if(!n)throw new Error("SettingsPrivacy element not found");return n}}class oe{constructor(e){this.sidebarMenu=null,this.topBloggers=null,this.pageWrapper=null,this.container=e,this.headerInstance=new I}async render(){return await this.renderFullPage(),this.pageWrapper}async renderFullPage(){this.container.innerHTML="",this.pageWrapper=document.createElement("div");const e=document.createElement("header"),t=await this.headerInstance.render(e);e.appendChild(t),this.pageWrapper.appendChild(e);const n=document.createElement("div");n.className="content-layout";const s=document.createElement("aside");s.className="sidebar-left";let r=null,i=null;const o=new C(w,"",e=>{const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});r=await o.render();const a=new C(_,"",e=>{const t=""===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});i=await a.render(),s.appendChild(r),s.appendChild(i);const c=document.createElement("main");c.className="main-content";const l=await this.renderPrivacyContent();c.appendChild(l);const d=document.createElement("aside");d.className="sidebar-right",this.topBloggers=new U;const h=await this.topBloggers.render();d.appendChild(h),n.appendChild(s),n.appendChild(c),n.appendChild(d),this.pageWrapper.appendChild(n),this.container.appendChild(this.pageWrapper)}async renderPrivacyContent(){const e=new ie({});return await e.render()}destroy(){this.headerInstance.destroy()}}const ae=new class extends c{constructor(){super({post:null,isLoading:!1,error:null})}registerActions(){this.registerAction("POST_LOAD_REQUEST",()=>{this.setState({isLoading:!0,error:null,post:null})}),this.registerAction("POST_LOAD_SUCCESS",e=>{this.setState({post:e.post,isLoading:!1,error:null})}),this.registerAction("POST_LOAD_FAIL",e=>{this.setState({post:null,isLoading:!1,error:e.error})})}};class ce{constructor(e,t){this.postCard=null,this.container=e,this.postId=t.id,this.headerInstance=new I,this.boundStoreHandler=this.handleStoreChange.bind(this),ae.addListener(this.boundStoreHandler)}async render(){i.dispatch("POST_LOAD_REQUEST",{postId:this.postId});const e=document.createElement("div"),t=document.createElement("header"),n=await this.headerInstance.render(t);t.appendChild(n),e.appendChild(t);const s=document.createElement("div");s.className="content-layout",e.appendChild(s);const r=document.createElement("aside");r.className="sidebar-left";let o=null,a=null;const c=e=>{e.querySelectorAll(".menu-item").forEach(e=>{e.classList.remove("menu-item--active")})},l=new C(w,"",e=>{a&&c(a);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});o=await l.render();const d=new C(_,"",e=>{o&&c(o);const t="fresh"===e?"/feed":`/feed?filter=${encodeURIComponent(e)}`;window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate"))});a=await d.render(),r.appendChild(o),r.appendChild(a);const h=document.createElement("main");h.className="main-content";const u=document.createElement("div");u.className="post-wrapper",u.id="post-wrapper",u.innerHTML='\n            <div class="post-view__loader" style="text-align: center; padding: 40px;">\n                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞...\n            </div>\n        ',h.appendChild(u);const p=document.createElement("aside");p.className="sidebar-right";const m=new U,g=await m.render();return p.appendChild(g),s.appendChild(r),s.appendChild(h),s.appendChild(p),e}handleStoreChange(){const e=ae.getState(),t=document.getElementById("post-wrapper");t&&(e.isLoading?t.innerHTML='\n                <div class="post-view__loader" style="text-align: center; padding: 40px;">\n                    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞...\n                </div>\n            ':e.error?t.innerHTML=`\n                <div class="post-view__error" style="text-align: center; padding: 40px; color: var(--text-failure);">\n                    ${e.error}\n                </div>\n            `:e.post&&this.renderPostInWrapper(e.post,t))}async renderPostInWrapper(e,t){const n=l.getState(),s=n.user?.id,r=!!s&&s===e.authorId,i={postId:e.id,authorId:e.authorId,user:{name:e.authorName||"–ê–Ω–æ–Ω–∏–º",subtitle:e.theme||"–ë–ª–æ–≥",avatar:e.authorAvatar||"/img/defaultAvatar.jpg",isSubscribed:!1,id:e.authorId},title:e.title||"",text:e.content||"",tags:Array.isArray(e.tags)?e.tags:[],commentsCount:e.commentsCount||0,repostsCount:e.repostsCount||0,viewsCount:e.viewsCount||0,isOwnPost:r};try{this.postCard=new R(i);const e=await this.postCard.render();t.innerHTML="",t.appendChild(e)}catch(e){console.error("–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø–æ—Å—Ç–∞:",e),t.innerHTML='\n                <div class="post-view__error" style="text-align: center; padding: 40px; color: var(--text-failure);">\n                    –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–æ—Å—Ç\n                </div>\n            '}}destroy(){this.headerInstance.destroy(),ae.removeListener(this.boundStoreHandler)}}(async function(){e.addRoute("/",H,"Mindleak - –ì–ª–∞–≤–Ω–∞—è"),e.addRoute("/profile",W,"Mindleak - –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"),e.addRoute("/user",W,"Mindleak - –ü—Ä–æ—Ñ–∏–ª—å"),e.addRoute("/settings",$,"Mindleak - –ù–∞—Å—Ç—Ä–æ–π–∫–∏"),e.addRoute("/settings/account",ee,"Mindleak - –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å"),e.addRoute("/settings/notifications",se,"Mindleak - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),e.addRoute("/settings/privacy",oe,"Mindleak - –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å"),e.addRoute("/post/:id",ce,"Mindleak - –ü–æ—Å—Ç"),e.init(),console.log("App initialized with routing")})().catch(console.error)})();